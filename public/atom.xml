<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>大洋</title>
  
  <subtitle>专注于前端</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://blog.html-js.site/"/>
  <updated>2021-09-14T02:36:03.589Z</updated>
  <id>http://blog.html-js.site/</id>
  
  <author>
    <name>大洋</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>谈谈对前端框架的理解</title>
    <link href="http://blog.html-js.site/2021/09/13/%E8%B0%88%E8%B0%88%E5%AF%B9%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6%E7%9A%84%E7%90%86%E8%A7%A3/"/>
    <id>http://blog.html-js.site/2021/09/13/谈谈对前端框架的理解/</id>
    <published>2021-09-13T06:58:27.000Z</published>
    <updated>2021-09-14T02:36:03.589Z</updated>
    
    <content type="html"><![CDATA[<p>最早的时候页面是服务端渲染的，也就是 PHP、JSP 那些技术，服务端通过模版引擎填充数据，返回生成的 html，交给浏览器渲染。那时候表单会同步提交，服务端返回结果页面的 html。</p><p>后来浏览器有了 ajax 技术，可以异步的请求，服务端返回 xml 或者 json。ajax 最早是基于 xml 的，这也是它名字的由来。因为 xml 多了很多没必要的标签，内容比较多，所以后来 json 流行开来。</p><p>网页和服务端的数据交互变成了异步的，可以服务端返回 json 数据，浏览器里拼接 html，之后渲染（浏览器里面生成 dom 就等同于渲染）。页面基本没啥刷新的必要了，于是后来就逐渐演变出了单页应用 SPA（single page application）。</p><p>早期开发页面的时候就是基于浏览器的 dom api 操作 dom 来做渲染和交互，但是 dom api 比较啰嗦，而且当时浏览器的兼容性问题也比较麻烦，不同浏览器有不同的写法。为了简化 dom 操作和更方便的兼容各种浏览器，出现了 jquery 并且迅速流行开来，那个时代 jquery 是如日中天的。</p><p>我一直习惯把网页分为物理层和逻辑层，dom 就算是物理层，jquery 是操作 dom 的一系列工具函数，也是工作在物理层。</p><p>网页做的事情基本就是拿到数据渲染 dom，并且数据改变之后更新 dom，这个流程是通用的，后来逐渐出现了 mvvm 框架，来自动把数据的变更映射到 dom，不再需要手动操作 dom。也就是 vue、react 等现代的前端框架。我把这一层叫做逻辑层。</p><p>前端框架除了提供了数据驱动视图变化的功能以外，还支持了 dom 的逻辑划分，可以把一部分 dom 封装成组件，组件和组件之间相互组合，构成整个界面。物理层依然是 dom，只是实现了数据到 dom 的自动映射之后，我们只需要在逻辑层写组件就可以了。</p><p>现在前端入门也不会再学物理层的操作 dom 的 jquery 了，而是直接从 vue、react 这种逻辑层的前端框架开始。</p><a id="more"></a><p>但是也不是说完全不需要 jquery，前端框架主要解决的是数据到 dom 的绑定，可以变化以后自动更新 dom。如果不需要更新，那么直接操作 dom 即可，比如各种活动页，没啥数据更新，用 jquery 操作 dom 还是很方便。</p><p>前端框架是 UI = f(state) 这种声明式的思想，只需要声明组件的视图、组件的状态数据、组件之间的依赖关系，那么状态改变就会自动的更新 dom。而 jquery 那种直接操作 dom 的工具函数库则是命令式的。</p><p>对于视图的描述这件事 react 和 vue 用了不同的方案，react 是给 js 扩展了 jsx 的语法，由 babel 实现，可以在描述视图的时候直接用 js 来写逻辑，没啥新语法。而 vue 是实现了一套 template 的 DSL，引入了插值、指令、过滤器等模版语法，相对于 jsx 来说更简洁，template 的编译器由 vue 实现。</p><p>vue template 是受限制的，只能访问 data，prop、method，可以静态的分析和优化，而 react 的 jsx 因为直接是 js 的语法，动态逻辑比较多，没法静态的做分析和优化。</p><p>但是 vue template 也不全是好处，因为和 js 上下文割裂开来，引入 typescript 做类型推导的时候就比较困难，需要单独把所有 prop、method、data 的类型声明一遍才行。而 react 的 jsx 本来就是和 js 同一个上下文，结合 typescript 就很自然。</p><p>所以 vue template 和 react jsx 各有优缺点。</p><p>前端框架都是数据驱动视图变化的，而这个数据分散在每个组件中，怎么在数据变化以后更新 dom 呢？</p><p>数据变化的检测基本只有三种方式：watch、脏检查、不检查。</p><p>vue 就是基于数据的 watch 的，组件级别通过 Object.defineProperty 监听对象属性的变化，重写数组的 api 监听数组元素的变化，之后进行 dom 的更新。</p><p>angular 则是基于脏检查，在每个可能改变数据的逻辑之后都对比下数据是否变了，变了的话就去更新 dom。</p><p>react 则是不检查，不检查难道每次都渲染全部的 dom 么？ 也不是，不检查是因为不直接渲染到 dom，而是中间加了一层虚拟 dom，每次都渲染成这个虚拟 dom，然后 diff 下渲染出的虚拟 dom 是否变了，变了的话就去更新对应的 dom。</p><p>这就是前端框架的数据驱动视图变化的三种思路。</p><p>vue 是组件级别的数据 watch，当组件内部监听数据变化的地方特别多的时候，一次更新可能计算量特别大，计算量大了就可能会导致丢帧，也就是渲染的卡顿。所以 vue 的优化方式就是把大组件拆成小组件，这样每个数据就不会有太多的 watcher 了。</p><p>react 并不监听数据的变化，而是渲染出整个虚拟 dom，然后 diff。基于这种方案的优化方式就是对于不需要重新生成 vdom 的组件，通过 shouldComponentUpdate 来跳过渲染。</p><p>但是当应用的组件树特别大的时候，只是 shouldComponentUpdate 跳过部分组件渲染，依然可能计算量特别大。计算量大了同样可能导致渲染的卡顿，怎么办呢？<br>树的遍历有深度优先和广度优先两种方式，组件树的渲染就是深度优先的，一般是通过递归来做，但是如果能通过链表记录下路径，就可以变成循环。变成了循环，那么就可以按照时间片分段，让 vdom 的生成不再阻塞页面渲染，这就像操作系统对多个进程的分时调度一样。</p><p>这个通过把组件树改成链表，把 vdom 的生成从递归改循环的功能就是 react fiber。</p><p><img src="/images/page/20210914/1.png" alt></p><p>fiber 节点相对于之前的组件节点来说，没有了 parent、children 这种属性，多了 child、sibling、return 属性。<br>通过 fiber 链表树，优化了渲染的性能。</p><p>可以看到 vue 的性能优化和 react 的性能优化是不一样的：</p><p>vue 是组件级别的数据监听的方案，问题可能出现在一个属性太多 watcher 的时候，所以优化思路就是大组件拆分成小组件，保证每个属性不要有太多 watcher。</p><p>react 不监听、不检查数据变化，每次都渲染生成 vdom，然后进行 vdom 的对比，那么优化的思路就是 shouldComponentUpdate 来跳过部分组件的 render，而且 react 内部也做了组件树的链表化（fiber）来把递归改成可打断的渲染，按照时间片来逐渐生成整个 vdom。</p><p>组件之间难免要有逻辑的复用，react 和 vue 有不同的方案：</p><p>vue 的组件是 option 对象的方式，那么逻辑复用方式很自然可以想到通过对象属性的 mixin，vue2 的组件内逻辑复用方案就是 mixin，但是 mixin 很难区分混入的属性、方法的来源，比较乱，代码维护性差。但也没有更好的方案。</p><p>react 刚开始也是支持 mixin 的，但后来废弃了。</p><p>react 的组件是 class 和 function 两种形式，那么类似高阶函数的高阶组件（high order component）的方式就比较自然，也就是组件套组件，在父组件里面执行一部分逻辑，然后渲染子组件。</p><p>除了多加一层组件的 HOC 方式以外，没有逻辑的部分可以直接把那部分 jsx 作为 props 传入另一个组件来复用，也就是 render props。</p><p>HOC 和 render props 是 react 的 class 组件支持的两种逻辑复用方案。</p><p>最开始的 function 组件是没有状态的，只是作为 class 组件渲染的辅助而存在。</p><p>但是 HOC 的逻辑复用方式最终导致了组件嵌套太深，而且 class 内部生命周期比较多，逻辑都放在一起导致了组件比较大。</p><p>怎么解决 class 组件嵌套深和组件大的问题呢？而且还不能引入破坏性的更新，不然下场可能会很惨。</p><p>于是 react 团队就瞅准了 function 组件，能不能在 function 组件里面也支持 state，通过扩展一些 api 的方式来支持，也不是破坏性的更新。</p><p>function 组件要支持 state，那 state 存在哪里呢？</p><p>class 组件节点有 state，变成 fiber 节点之后依然有，function 组件本来就没有 state，那么 fiber 节点中同样也没有。</p><p>那在 function 组件的 fiber 节点中加入 state 不就行了？</p><p>于是 react 就在 function 组件的 fiber 节点中加入了 memorizedState 属性用来存储数据，然后在 function 组件里面通过 api 来使用这些数据，这些 api 被叫做 hooks api。</p><p>因为是使用 fiber 节点上的数据，就把 api 命名为了 useXxx。</p><p>每个 hooks api 都要有自己存放数据的地方，怎么组织呢？有两种方案，一种是 map，一种是数组。</p><p>用 map 的话那么要 hooks api 要指定 key，按照 key 来存取 fiber 节点中的数据。</p><p>用数组的话顺序不能变，所以 hooks api 不能出现在 if 等逻辑块中，只能在顶层。</p><p>为了简化使用， hooks 最终使用了数组的方式。当然，实现起来用的是链表。</p><p>每个 hooks api 取对应的 fiber.memoriedState 中的数据来用。</p><p>hooks api 可以分为 3 类：</p><p>第一类是数据类的：</p><ul><li>useState： 在 fiber.memoriedState 的对应元素中存放数据</li><li>useMemo：在 fiber.memoriedState 的对应元素中存放数据，值是缓存的函数计算的结果，在 state 变化后重新计算值</li><li>useCallback：在 fiber.memoriedState 的对应元素中存放数据，值是函数，在 state 变化后重新执行函数，是 useMemo 在值为函数的场景下的简化 api，比如 useCallback(fn, [a,b]) 相当于 useMemo(() =&gt; fn, [a, b])</li><li>useReducer：在 fiber.memoriedState 的对应元素中存放数据，值为 reducer 返回的结果，可以通过 action 来触发值的变更</li><li>useRef：在 fiber.memoriedState 的对应元素中存放数据，值为 {current: 具体值} 的形式，因为对象不变，只是 current 属性变了，所以不会修改。</li></ul><p>useState 是存储值最简单的方式，useMemo 是基于 state 执行函数并且缓存结果，相当于 vue 的 getter，useCallback 是一种针对值为函数的情况的简化，useReducer 是通过 action 来触发值的修改。useRef 包了一层对象，每次对比都是同一个，所以可以放一些不变的数据。<br>不管形式怎么样，这些 hooks 的 api 的作用都是返回值的。</p><p>第二类是逻辑类的：</p><ul><li>useEffect：异步执行函数，当依赖 state 变化之后会再次执行，当组件销毁的时候会调用返回的清理函数</li><li>useLayoutEffect： 在渲染完成后同步执行函数，可以拿到 dom</li></ul><p>这两个 hooks api 都是用于执行逻辑的，不需要等渲染完的逻辑都可以放到 useEffect 里。</p><p>第三类是 ref 转发专用的：<br>数据可以通过各种方案共享，但是 dom 元素这种就得通过 ref 转发了，所谓的 ref 转发就是在父组件创建 ref，然后子组件把元素传过去。传过去之前想做一些修改，就可以用 useImperativeHandle 来改。</p><p>通过这 3 类 hooks api，以及之后会添加的更多 hooks api ，函数组件里面也能做 state 的存储，也能在一些阶段执行一段逻辑，是可以替代 class 组件的方案了。</p><p>而且更重要的是，hooks api 是传递参数的函数调用的形式，可以对 hooks api 进一步封装成功能更强大的函数，也就是自定义 hooks。通过这种方式就可以做跨组件的逻辑复用了。</p><p>再回头看一下最开始要解决的 class 组件嵌套过深和组件太大的问题，通过 hooks 都能解决：</p><ul><li>逻辑扩展不需要嵌套 hoc 了，多调用一个自定义的 hooks 就行</li><li>组件的逻辑也不用都写在 class 里了，完全可以抽离成不同的 hooks</li></ul><p>react 通过 function 组件的 hooks api 解决了 class 组件的逻辑复用方案的问题。（fiber 是解决性能问题的，而 hooks 是解决逻辑复用问题的）</p><p>vue2 中是通过 mixin 的方式来复用逻辑的，也有组件太大的问题，在 vue3 中也可以通过类似的思路来解决。</p><p>为了体验和原生更接近，现在基本都是不刷新页面的单页应用，都是从服务端取数据然后驱动 dom 变化的 浏览器渲染(csr)方案。但对于一些低端机，仍然需要服务端渲染(ssr)的方案。但不能回到 jsp、php 时代的那种模版引擎服务端渲染了，而是要基于同一个组件树，把它渲染成字符串。服务端渲染和浏览器渲染都用同样的组件代码，这就是同构的方案。</p><p>技术从出现到完善到连带的周边生态的完善是一个轮回，从最开始服务端渲染，到了后来的客户端渲染，然后出现了逻辑层的组件方案，最后又要基于组件方案重新实现服务端渲染。其实物理层的东西一直都没变，只是逻辑层不断的一层添加又一层，目的都是为了提高生产效率，降低开发成本，保证质量，这也是技术发展的趋势。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;最早的时候页面是服务端渲染的，也就是 PHP、JSP 那些技术，服务端通过模版引擎填充数据，返回生成的 html，交给浏览器渲染。那时候表单会同步提交，服务端返回结果页面的 html。&lt;/p&gt;
&lt;p&gt;后来浏览器有了 ajax 技术，可以异步的请求，服务端返回 xml 或者 json。ajax 最早是基于 xml 的，这也是它名字的由来。因为 xml 多了很多没必要的标签，内容比较多，所以后来 json 流行开来。&lt;/p&gt;
&lt;p&gt;网页和服务端的数据交互变成了异步的，可以服务端返回 json 数据，浏览器里拼接 html，之后渲染（浏览器里面生成 dom 就等同于渲染）。页面基本没啥刷新的必要了，于是后来就逐渐演变出了单页应用 SPA（single page application）。&lt;/p&gt;
&lt;p&gt;早期开发页面的时候就是基于浏览器的 dom api 操作 dom 来做渲染和交互，但是 dom api 比较啰嗦，而且当时浏览器的兼容性问题也比较麻烦，不同浏览器有不同的写法。为了简化 dom 操作和更方便的兼容各种浏览器，出现了 jquery 并且迅速流行开来，那个时代 jquery 是如日中天的。&lt;/p&gt;
&lt;p&gt;我一直习惯把网页分为物理层和逻辑层，dom 就算是物理层，jquery 是操作 dom 的一系列工具函数，也是工作在物理层。&lt;/p&gt;
&lt;p&gt;网页做的事情基本就是拿到数据渲染 dom，并且数据改变之后更新 dom，这个流程是通用的，后来逐渐出现了 mvvm 框架，来自动把数据的变更映射到 dom，不再需要手动操作 dom。也就是 vue、react 等现代的前端框架。我把这一层叫做逻辑层。&lt;/p&gt;
&lt;p&gt;前端框架除了提供了数据驱动视图变化的功能以外，还支持了 dom 的逻辑划分，可以把一部分 dom 封装成组件，组件和组件之间相互组合，构成整个界面。物理层依然是 dom，只是实现了数据到 dom 的自动映射之后，我们只需要在逻辑层写组件就可以了。&lt;/p&gt;
&lt;p&gt;现在前端入门也不会再学物理层的操作 dom 的 jquery 了，而是直接从 vue、react 这种逻辑层的前端框架开始。&lt;/p&gt;
    
    </summary>
    
    
      <category term="前端" scheme="http://blog.html-js.site/tags/%E5%89%8D%E7%AB%AF/"/>
    
  </entry>
  
  <entry>
    <title>Jenkins自动化构建</title>
    <link href="http://blog.html-js.site/2021/09/09/Jenkins%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%84%E5%BB%BA/"/>
    <id>http://blog.html-js.site/2021/09/09/Jenkins自动化构建/</id>
    <published>2021-09-09T08:46:46.000Z</published>
    <updated>2021-09-09T08:47:03.018Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://www.jianshu.com/p/5f671aca2b5a" target="_blank" rel="noopener">https://www.jianshu.com/p/5f671aca2b5a</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;a href=&quot;https://www.jianshu.com/p/5f671aca2b5a&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://www.jianshu.com/p/5f671aca2b5a&lt;/a&gt;&lt;/p&gt;

      
    
    </summary>
    
    
      <category term="前端工程化" scheme="http://blog.html-js.site/tags/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>前端工程化</title>
    <link href="http://blog.html-js.site/2021/09/09/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/"/>
    <id>http://blog.html-js.site/2021/09/09/前端工程化/</id>
    <published>2021-09-09T08:45:27.000Z</published>
    <updated>2021-09-10T08:51:05.230Z</updated>
    
    <summary type="html">
    
    </summary>
    
    
      <category term="前端工程化" scheme="http://blog.html-js.site/tags/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>阿里云ECS-CentOs(linux)</title>
    <link href="http://blog.html-js.site/2021/09/05/%E9%98%BF%E9%87%8C%E4%BA%91ECS-CentOs-linux/"/>
    <id>http://blog.html-js.site/2021/09/05/阿里云ECS-CentOs-linux/</id>
    <published>2021-09-05T13:16:35.000Z</published>
    <updated>2021-09-10T08:34:23.958Z</updated>
    
    <content type="html"><![CDATA[<h3 id="linux文件目录"><a href="#linux文件目录" class="headerlink" title="linux文件目录"></a>linux文件目录</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">/       - 根</span><br><span class="line">/bin    - 用户二进制文件</span><br><span class="line">/sbin   - 系统二进制文件</span><br><span class="line">/etc    - 配置文件，比如nginx配置文件</span><br><span class="line">/dev    - 设备文件</span><br><span class="line">/proc   - 进程信息</span><br><span class="line">/<span class="keyword">var</span>    - 变量文件</span><br><span class="line">/tmp    - 临时文件</span><br><span class="line">/usr    - 用户程序</span><br><span class="line">/home   - HOME目录，所有用户用home目录来存储他们的个人档案。</span><br><span class="line">/boot   - 引导加载程序文件</span><br><span class="line">/lib    - 系统库</span><br><span class="line">/opt    - 可选的附加应用程序</span><br><span class="line">/mnt    - 挂载目录</span><br><span class="line">/media  - 可移动媒体设备</span><br><span class="line">/srv    - 服务数据</span><br></pre></td></tr></table></figure><h3 id="linux搭建环境"><a href="#linux搭建环境" class="headerlink" title="linux搭建环境"></a>linux搭建环境</h3><ul><li><a href="https://help.aliyun.com/document_detail/173042.html?spm=5176.21213303.J_6028563670.7.572a3edaz0dICA&amp;scm=20140722.S_help%40%40%E6%96%87%E6%A1%A3%40%40173042.S_hot%2Bos0.ID_173042-RL_centos%E5%AE%89%E8%A3%85nginx-OR_helpmain-V_2-P0_0" target="_blank" rel="noopener">linux安及配置装nginx</a></li><li><a href="https://help.aliyun.com/document_detail/50775.html" target="_blank" rel="noopener">linux安装git</a></li><li><a href="https://help.aliyun.com/document_detail/50775.html" target="_blank" rel="noopener">CentOs安装node</a></li></ul><a id="more"></a><h3 id="nginx配置"><a href="#nginx配置" class="headerlink" title="nginx配置"></a>nginx配置</h3><h4 id="1、运行以下命令查看Nginx配置文件的默认路径"><a href="#1、运行以下命令查看Nginx配置文件的默认路径" class="headerlink" title="1、运行以下命令查看Nginx配置文件的默认路径"></a>1、运行以下命令查看Nginx配置文件的默认路径</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/nginx/nginx.conf</span><br></pre></td></tr></table></figure><h4 id="2、进入对应目录"><a href="#2、进入对应目录" class="headerlink" title="2、进入对应目录"></a>2、进入对应目录</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd /etc/nginx/conf.d  <span class="comment">// 进入相关目录</span></span><br></pre></td></tr></table></figure><h4 id="3、运行一下命令打开默认配置文件"><a href="#3、运行一下命令打开默认配置文件" class="headerlink" title="3、运行一下命令打开默认配置文件"></a>3、运行一下命令打开默认配置文件</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi <span class="keyword">default</span>.conf <span class="comment">// 编辑配置文件</span></span><br></pre></td></tr></table></figure><h4 id="4、按i进入编辑模式。"><a href="#4、按i进入编辑模式。" class="headerlink" title="4、按i进入编辑模式。"></a>4、按<code>i</code>进入编辑模式。</h4><h4 id="5、在location大括号内，修改以下内容。"><a href="#5、在location大括号内，修改以下内容。" class="headerlink" title="5、在location大括号内，修改以下内容。"></a>5、在<code>location</code>大括号内，修改以下内容。</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">location / &#123;</span><br><span class="line">    #将该路径替换为您的网站根目录。</span><br><span class="line">    root   /usr/share/nginx/html;</span><br><span class="line">    #添加默认首页信息index.php。</span><br><span class="line">    index  index.html index.htm index.php;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="6、去掉被注释的location-php-大括号内容前的-，并修改大括号的内容。"><a href="#6、去掉被注释的location-php-大括号内容前的-，并修改大括号的内容。" class="headerlink" title="6、去掉被注释的location ~ \.php$大括号内容前的#，并修改大括号的内容。"></a>6、去掉被注释的<code>location ~ \.php$</code>大括号内容前的<code>#</code>，并修改大括号的内容。</h4><p>修改完成如下所示。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">location ~ \.php$ &#123;</span><br><span class="line">    #将该路径替换为您的网站根目录。</span><br><span class="line">    root           /usr/share/nginx/html;</span><br><span class="line">    #Nginx通过unix套接字与PHP-FPM建立联系，该配置与/etc/php-fpm.d/www.conf文件内的listen配置一致。</span><br><span class="line">    fastcgi_pass   unix:<span class="regexp">/run/</span>php-fpm/www.sock;</span><br><span class="line">    fastcgi_index  index.php;</span><br><span class="line">    #将/scripts$fastcgi_script_name修改为$document_root$fastcgi_script_name。</span><br><span class="line">    fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;</span><br><span class="line">    #Nginx调用fastcgi接口处理PHP请求。</span><br><span class="line">    include        fastcgi_params;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h4 id="7、按下esc，并输入-wq保存退出文件"><a href="#7、按下esc，并输入-wq保存退出文件" class="headerlink" title="7、按下esc，并输入:wq保存退出文件"></a>7、按下<code>esc</code>，并输入<code>:wq</code>保存退出文件</h4><h4 id="8、运行以下命令启动Nginx服务。"><a href="#8、运行以下命令启动Nginx服务。" class="headerlink" title="8、运行以下命令启动Nginx服务。"></a>8、运行以下命令启动Nginx服务。</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start nginx</span><br></pre></td></tr></table></figure><h4 id="9、运行以下命令设置Nginx服务开机自启动。"><a href="#9、运行以下命令设置Nginx服务开机自启动。" class="headerlink" title="9、运行以下命令设置Nginx服务开机自启动。"></a>9、运行以下命令设置Nginx服务开机自启动。</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable nginx</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;linux文件目录&quot;&gt;&lt;a href=&quot;#linux文件目录&quot; class=&quot;headerlink&quot; title=&quot;linux文件目录&quot;&gt;&lt;/a&gt;linux文件目录&lt;/h3&gt;&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;/       - 根&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;/bin    - 用户二进制文件&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;/sbin   - 系统二进制文件&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;/etc    - 配置文件，比如nginx配置文件&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;/dev    - 设备文件&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;/proc   - 进程信息&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;/&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt;    - 变量文件&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;/tmp    - 临时文件&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;/usr    - 用户程序&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;/home   - HOME目录，所有用户用home目录来存储他们的个人档案。&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;/boot   - 引导加载程序文件&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;/lib    - 系统库&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;/opt    - 可选的附加应用程序&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;/mnt    - 挂载目录&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;/media  - 可移动媒体设备&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;/srv    - 服务数据&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;linux搭建环境&quot;&gt;&lt;a href=&quot;#linux搭建环境&quot; class=&quot;headerlink&quot; title=&quot;linux搭建环境&quot;&gt;&lt;/a&gt;linux搭建环境&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://help.aliyun.com/document_detail/173042.html?spm=5176.21213303.J_6028563670.7.572a3edaz0dICA&amp;amp;scm=20140722.S_help%40%40%E6%96%87%E6%A1%A3%40%40173042.S_hot%2Bos0.ID_173042-RL_centos%E5%AE%89%E8%A3%85nginx-OR_helpmain-V_2-P0_0&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;linux安及配置装nginx&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://help.aliyun.com/document_detail/50775.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;linux安装git&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://help.aliyun.com/document_detail/50775.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;CentOs安装node&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
    
      <category term="linux" scheme="http://blog.html-js.site/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>程序员怎样保持竞争力</title>
    <link href="http://blog.html-js.site/2021/09/03/%E7%A8%8B%E5%BA%8F%E5%91%98%E6%80%8E%E6%A0%B7%E4%BF%9D%E6%8C%81%E7%AB%9E%E4%BA%89%E5%8A%9B/"/>
    <id>http://blog.html-js.site/2021/09/03/程序员怎样保持竞争力/</id>
    <published>2021-09-03T02:07:07.000Z</published>
    <updated>2021-09-03T02:14:08.305Z</updated>
    
    <content type="html"><![CDATA[<p>软件工程师最基本的能力就是<code>算法</code>+<code>coding</code>，经常刷题可以让自己保持手感，我已经坚持3年打卡<a href="https://leetcode-cn.com/" target="_blank" rel="noopener">leetcode</a>，一天未拉下，每天解决一道新题</p><p><img src="/images/page/leetcode/1.jpeg" alt></p><p>当然如果你只会刷题，你的竞争力就最多只是做一个合格的额螺丝钉。越高级的软件工程师需要在一个垂直领域有所擅长，比如系统设计。有了 <code>Domain of Expertise</code>，才能更好的升值。</p><p>软件工程师需要有一些能拿得出手的作品，可以是之前公司所贡献或领导的产品，也可以是业余弄的 <code>side project</code>，比如可以是<code>开源</code>，或者是一些<a href="https://justyy.com/archives/31554" target="_blank" rel="noopener">挣钱</a>的项目。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;软件工程师最基本的能力就是&lt;code&gt;算法&lt;/code&gt;+&lt;code&gt;coding&lt;/code&gt;，经常刷题可以让自己保持手感，我已经坚持3年打卡&lt;a href=&quot;https://leetcode-cn.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;
      
    
    </summary>
    
    
      <category term="职场" scheme="http://blog.html-js.site/tags/%E8%81%8C%E5%9C%BA/"/>
    
      <category term="程序员" scheme="http://blog.html-js.site/tags/%E7%A8%8B%E5%BA%8F%E5%91%98/"/>
    
  </entry>
  
  <entry>
    <title>windows下nginx的安装及使用</title>
    <link href="http://blog.html-js.site/2021/09/02/windows%E4%B8%8Bnginx%E7%9A%84%E5%AE%89%E8%A3%85%E5%8F%8A%E4%BD%BF%E7%94%A8/"/>
    <id>http://blog.html-js.site/2021/09/02/windows下nginx的安装及使用/</id>
    <published>2021-09-02T08:56:15.000Z</published>
    <updated>2021-09-02T14:24:40.368Z</updated>
    
    <content type="html"><![CDATA[<h3 id="下载nginx"><a href="#下载nginx" class="headerlink" title="下载nginx"></a>下载nginx</h3><p><a href="http://nginx.org/en/download.html" target="_blank" rel="noopener">http://nginx.org/en/download.html</a></p><p>下载稳定版本，以<code>nginx/Windows-1.12.2</code>为例，直接下载 <code>nginx-1.12.2.zip</code><br>下载后解压，解压后如下</p><p><img src="/images/page/nginx/1.png" alt></p><h3 id="nginx命令"><a href="#nginx命令" class="headerlink" title="nginx命令"></a>nginx命令</h3><p><code>Windows</code>下<code>Nginx</code>的启动、停止等命令, 可以进入到<code>nginx</code>的安装根目录，执行<code>nginx.exe -h</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">注意不要直接双击nginx.exe，这样会导致修改配置后重启、停止nginx无效，需要手动关闭任务管理器内的所有nginx进程</span><br><span class="line">在nginx.exe目录，打开命令行工具，用命令 启动/关闭/重启nginx </span><br><span class="line">start nginx : 启动nginx</span><br><span class="line">nginx -s reload  ：修改配置后重新加载生效</span><br><span class="line">nginx -s reopen  ：重新打开日志文件</span><br><span class="line">nginx -t -c /path/to/nginx.conf 测试nginx配置文件是否正确</span><br><span class="line">关闭nginx：</span><br><span class="line">nginx -s stop  :快速停止nginx</span><br><span class="line">nginx -s quit  ：完整有序的停止nginx</span><br><span class="line">如果遇到报错：</span><br><span class="line">bash: nginx: command not found</span><br><span class="line">有可能是你再linux命令行环境下运行了windows命令，</span><br><span class="line">如果你之前是允许 nginx -s reload报错， 试下 ./nginx.exe -s reload</span><br><span class="line">或者 用windows系统自带命令行工具运行</span><br></pre></td></tr></table></figure><a id="more"></a><h3 id="检查nginx是否启动成功"><a href="#检查nginx是否启动成功" class="headerlink" title="检查nginx是否启动成功"></a>检查nginx是否启动成功</h3><p>直接在浏览器地址栏输入网址 <a href="http://localhost:80，回车，出现以下页面说明启动成功" target="_blank" rel="noopener">http://localhost:80，回车，出现以下页面说明启动成功</a></p><p><img src="/images/page/nginx/2.png" alt></p><h3 id="nginx配置"><a href="#nginx配置" class="headerlink" title="nginx配置"></a>nginx配置</h3><p>nginx安装目录下 conf目录下的nginx.conf，默认配置的nginx监听的端口为80，如果80端口被占用可以修改为未被占用的端口即可</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">静态服务器</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line"></span><br><span class="line">  listen      <span class="number">80</span>;</span><br><span class="line">  #  server_name crmmanage.superboss.cc;</span><br><span class="line">  server_name blog.html-js.site;</span><br><span class="line">  #  server_name crmappdev.hz.taeapp.com;</span><br><span class="line">  charset utf<span class="number">-8</span>;</span><br><span class="line">  index index.html;</span><br><span class="line"></span><br><span class="line">  location / &#123;</span><br><span class="line">    # root   /Users/wy/project/hexo-blog; # mac</span><br><span class="line">    root   "D:/project/hexo-blog"; # windows</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">反向代理</span><br><span class="line">hosts 绑定 <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> p.crm</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line"></span><br><span class="line">    listen       <span class="number">80</span>;</span><br><span class="line">    server_name p.crm;</span><br><span class="line">    charset utf<span class="number">-8</span>;</span><br><span class="line">    index index.html;</span><br><span class="line"></span><br><span class="line">    location ~* ^.+\.(rjson)$ &#123;</span><br><span class="line">        # 测试环境</span><br><span class="line">        proxy_pass http:<span class="comment">//dingcrmapp.superboss.cc;</span></span><br><span class="line">        #  proxy_pass http://192.168.63.41:8080;  #沛文</span><br><span class="line">    &#125;</span><br><span class="line">    location / &#123;</span><br><span class="line">        proxy_pass http:<span class="comment">//localhost:8000;  # 本地服务</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="使用nginx代理服务器做负载均衡"><a href="#使用nginx代理服务器做负载均衡" class="headerlink" title="使用nginx代理服务器做负载均衡"></a>使用nginx代理服务器做负载均衡</h3><p>我们可以修改<code>nginx</code>的配置文件<code>nginx.conf</code> 达到访问<code>nginx</code>代理服务器时跳转到指定服务器的目的，即通过<code>proxy_pass</code> 配置请求转发地址，即当我们依然输入<code>http://localhost:80</code> 时，请求会跳转到我们配置的服务器</p><p><img src="/images/page/nginx/3.png" alt></p><p>同理，我们可以配置多个目标服务器，当一台服务器出现故障时，nginx能将请求自动转向另一台服务器，例如配置如下：</p><p><img src="/images/page/nginx/4.png" alt></p><p>当服务器 <code>localhost:8080</code> 挂掉时，<code>nginx</code>能将请求自动转向服务器 <code>192.168.101.9:8080</code> 。上面还加了一个<code>weight</code>属性，此属性表示各服务器被访问到的权重，<code>weight</code><br>越高被访问到的几率越高。</p><h3 id="测试或载入指定配置文件"><a href="#测试或载入指定配置文件" class="headerlink" title="测试或载入指定配置文件"></a>测试或载入指定配置文件</h3><p>注意，修改了配置文件后最好先检查一下修改过的配置文件是否正 确，以免重启后Nginx出现错误影响服务器稳定运行。判断Nginx配置是否正确命令如下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\server\nginx<span class="number">-1.0</span><span class="number">.2</span>&gt;nginx.exe -t -c conf/<span class="keyword">default</span>.conf</span><br></pre></td></tr></table></figure><blockquote><p>nginx: the configuration file C:\server\nginx-1.0.2/conf/default.conf syntax isok<br>nginx: configuration file C:\server\nginx-1.0.2/conf/default.conf test is successful</p></blockquote><p>载入指定配置文件<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\server\nginx<span class="number">-1.0</span><span class="number">.2</span>&gt;start nginx.exe -c conf/<span class="keyword">default</span>.conf</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;下载nginx&quot;&gt;&lt;a href=&quot;#下载nginx&quot; class=&quot;headerlink&quot; title=&quot;下载nginx&quot;&gt;&lt;/a&gt;下载nginx&lt;/h3&gt;&lt;p&gt;&lt;a href=&quot;http://nginx.org/en/download.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;http://nginx.org/en/download.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;下载稳定版本，以&lt;code&gt;nginx/Windows-1.12.2&lt;/code&gt;为例，直接下载 &lt;code&gt;nginx-1.12.2.zip&lt;/code&gt;&lt;br&gt;下载后解压，解压后如下&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/page/nginx/1.png&quot; alt&gt;&lt;/p&gt;
&lt;h3 id=&quot;nginx命令&quot;&gt;&lt;a href=&quot;#nginx命令&quot; class=&quot;headerlink&quot; title=&quot;nginx命令&quot;&gt;&lt;/a&gt;nginx命令&lt;/h3&gt;&lt;p&gt;&lt;code&gt;Windows&lt;/code&gt;下&lt;code&gt;Nginx&lt;/code&gt;的启动、停止等命令, 可以进入到&lt;code&gt;nginx&lt;/code&gt;的安装根目录，执行&lt;code&gt;nginx.exe -h&lt;/code&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;注意不要直接双击nginx.exe，这样会导致修改配置后重启、停止nginx无效，需要手动关闭任务管理器内的所有nginx进程&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;在nginx.exe目录，打开命令行工具，用命令 启动/关闭/重启nginx &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;start nginx : 启动nginx&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;nginx -s reload  ：修改配置后重新加载生效&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;nginx -s reopen  ：重新打开日志文件&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;nginx -t -c /path/to/nginx.conf 测试nginx配置文件是否正确&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;关闭nginx：&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;nginx -s stop  :快速停止nginx&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;nginx -s quit  ：完整有序的停止nginx&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;如果遇到报错：&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;bash: nginx: command not found&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;有可能是你再linux命令行环境下运行了windows命令，&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;如果你之前是允许 nginx -s reload报错， 试下 ./nginx.exe -s reload&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;或者 用windows系统自带命令行工具运行&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="nginx" scheme="http://blog.html-js.site/tags/nginx/"/>
    
      <category term="全栈" scheme="http://blog.html-js.site/tags/%E5%85%A8%E6%A0%88/"/>
    
  </entry>
  
  <entry>
    <title>git commit前检测husky与pre-commit</title>
    <link href="http://blog.html-js.site/2021/08/23/git-commit%E5%89%8D%E6%A3%80%E6%B5%8Bhusky%E4%B8%8Epre-commit/"/>
    <id>http://blog.html-js.site/2021/08/23/git-commit前检测husky与pre-commit/</id>
    <published>2021-08-23T06:27:15.000Z</published>
    <updated>2021-09-10T08:50:46.950Z</updated>
    
    <content type="html"><![CDATA[<h3 id="一、前言"><a href="#一、前言" class="headerlink" title="一、前言"></a>一、前言</h3><p>现在最流行的版本管理工具非<code>git</code>莫属，而良好的代码规范有助于项目的维护，为了防止一些不规范的代码 <code>commit</code>并<code>push</code>到远端,我们可以在<code>git</code>命令执行前用一些钩子来检测并阻止。现在大前端主要有两种<code>git</code>钩子插件：<code>husky</code>（<code>jquery</code>与<code>next.js</code>都在用），<code>pre-commit</code>(antd在用)。<br>下面我将现介绍一个<code>git</code>钩子，再介绍下<code>husky</code>与<code>pre-commit</code>的用法</p><h3 id="二、git钩子"><a href="#二、git钩子" class="headerlink" title="二、git钩子"></a>二、git钩子</h3><p>用过<code>git</code>的小伙伴们都知道<code>git</code>有很多命令<code>commit</code>、<code>push</code>、<code>rebase</code>等等。那这些命令主要是在执行<code>.git</code>文件夹中的东西，那么<code>git</code> 钩子目录就是在<code>.git</code>文件夹的<code>hooks</code>下，如下所示：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd .git/hooks</span><br><span class="line">ls -l</span><br></pre></td></tr></table></figure><p><img src="/images/page/husky/1.jpeg" alt></p><p>上图为各个钩子的案例脚本，可以把<code>sample</code>去掉，直接编写<code>shell</code>脚本来执行。<br>而前端的小伙伴们则可以用插件<code>husky</code>与<code>pre-commit</code>，来使钩子生效。<br>注意： 一般<code>.git</code>为隐藏文件，可以把项目拖入IDE中查看,<code>.git</code>文件里的内容一般不允许手动更改的。</p><a id="more"></a><h3 id="三、husky"><a href="#三、husky" class="headerlink" title="三、husky"></a>三、husky</h3><p><code>husky</code>能够防止不规范代码被<code>commit</code>、<code>push</code>、<code>merge</code>等等。</p><p>首先安装<code>husky</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install husky --save-dev</span><br></pre></td></tr></table></figure><p>编辑<code>package.json</code>文件，如：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"scripts"</span>: &#123;</span><br><span class="line">    <span class="string">"precommit"</span>: <span class="string">"webpack  --config ./web/webpack.config.js"</span>,</span><br><span class="line">    <span class="string">"..."</span>: <span class="string">"..."</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>当你<code>git commit</code>的时候，将会现现执行<code>precommit</code>里的脚本，没有问题了再提交。</p><p><img src="/images/page/husky/2.jpeg" alt></p><p>具体案例可查看<a href="https://link.zhihu.com/?target=https%3A//github.com/raoenhui/create-img" target="_blank" rel="noopener">https://link.zhihu.com/?target=https%3A//github.com/raoenhui/create-img</a></p><h3 id="四、pre-commit"><a href="#四、pre-commit" class="headerlink" title="四、pre-commit"></a>四、pre-commit</h3><p><code>pre-commit</code>能够防止不规范代码被<code>commit</code>，没有<code>husky</code>这么全面，但是你可以接着安装<code>pre-push</code>等插件来防止对应的git操作。下面以<code>pre-commit</code>为例：<br>首先安装<code>pre-commit</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install pre-commit --save-dev</span><br></pre></td></tr></table></figure><p>编辑<code>package.json</code>文件，如：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"scripts"</span>: &#123;</span><br><span class="line">  <span class="string">"test"</span>: <span class="string">"echo \"Error: I SHOULD FAIL LOLOLOLOLOL \" &amp;&amp; exit 1"</span>,</span><br><span class="line">  <span class="string">"foo"</span>: <span class="string">"echo \"fooo\" &amp;&amp; exit 0"</span>,</span><br><span class="line">  <span class="string">"bar"</span>: <span class="string">"echo \"bar\" &amp;&amp; exit 0"</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="string">"pre-commit"</span>: [</span><br><span class="line">  <span class="string">"foo"</span>,</span><br><span class="line">  <span class="string">"bar"</span>,</span><br><span class="line">  <span class="string">"test"</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure><p><code>pre-commit</code>的配置项非常灵活，还可以下面这样写：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"precommit"</span>: <span class="string">"foo, bar, test"</span></span><br><span class="line">  <span class="string">"pre-commit"</span>: <span class="string">"foo, bar, test"</span></span><br><span class="line">  <span class="string">"pre-commit"</span>: [<span class="string">"foo"</span>, <span class="string">"bar"</span>, <span class="string">"test"</span>]</span><br><span class="line">  <span class="string">"precommit"</span>: [<span class="string">"foo"</span>, <span class="string">"bar"</span>, <span class="string">"test"</span>],</span><br><span class="line">  <span class="string">"precommit"</span>: &#123;</span><br><span class="line">    <span class="string">"run"</span>: <span class="string">"foo, bar, test"</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"pre-commit"</span>: &#123;</span><br><span class="line">    <span class="string">"run"</span>: [<span class="string">"foo"</span>, <span class="string">"bar"</span>, <span class="string">"test"</span>],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"precommit"</span>: &#123;</span><br><span class="line">    <span class="string">"run"</span>: [<span class="string">"foo"</span>, <span class="string">"bar"</span>, <span class="string">"test"</span>],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"pre-commit"</span>: &#123;</span><br><span class="line">    <span class="string">"run"</span>: <span class="string">"foo, bar, test"</span>,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>你配置好后，执行<code>git commit</code>命令，它将会依次执行<code>foo</code>、<code>bar</code>、<code>test</code>来检测完善代码。</p><h3 id="五、总结"><a href="#五、总结" class="headerlink" title="五、总结"></a>五、总结</h3><p>我们已经怎么用<code>git</code>钩子插件了，那么我们一般用它来做什么呢。</p><p><code>prevent commit</code>时，我们可以把<code>eslint</code>以及<code>test</code>命令加上，检测代码规范：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"scripts"</span>: &#123;</span><br><span class="line">  <span class="string">"precommit"</span>: <span class="string">"lint-staged &amp;&amp; npm run test"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>prevent publish</code> 主干分支时，我们可以把<code>tag</code>打上：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"scripts"</span>: &#123;</span><br><span class="line">  <span class="string">"precommit"</span>: <span class="string">"npm run tag"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>具体怎么自动化打tag标签，可以参考<br><a href="https://raoenhui.github.io/nodejs/git/2018/03/30/nodejs%E8%87%AA%E5%8A%A8%E7%94%9F%E6%88%90tag/" target="_blank" rel="noopener">https://raoenhui.github.io/nodejs/git/2018/03/30/nodejs%E8%87%AA%E5%8A%A8%E7%94%9F%E6%88%90tag/</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;一、前言&quot;&gt;&lt;a href=&quot;#一、前言&quot; class=&quot;headerlink&quot; title=&quot;一、前言&quot;&gt;&lt;/a&gt;一、前言&lt;/h3&gt;&lt;p&gt;现在最流行的版本管理工具非&lt;code&gt;git&lt;/code&gt;莫属，而良好的代码规范有助于项目的维护，为了防止一些不规范的代码 &lt;code&gt;commit&lt;/code&gt;并&lt;code&gt;push&lt;/code&gt;到远端,我们可以在&lt;code&gt;git&lt;/code&gt;命令执行前用一些钩子来检测并阻止。现在大前端主要有两种&lt;code&gt;git&lt;/code&gt;钩子插件：&lt;code&gt;husky&lt;/code&gt;（&lt;code&gt;jquery&lt;/code&gt;与&lt;code&gt;next.js&lt;/code&gt;都在用），&lt;code&gt;pre-commit&lt;/code&gt;(antd在用)。&lt;br&gt;下面我将现介绍一个&lt;code&gt;git&lt;/code&gt;钩子，再介绍下&lt;code&gt;husky&lt;/code&gt;与&lt;code&gt;pre-commit&lt;/code&gt;的用法&lt;/p&gt;
&lt;h3 id=&quot;二、git钩子&quot;&gt;&lt;a href=&quot;#二、git钩子&quot; class=&quot;headerlink&quot; title=&quot;二、git钩子&quot;&gt;&lt;/a&gt;二、git钩子&lt;/h3&gt;&lt;p&gt;用过&lt;code&gt;git&lt;/code&gt;的小伙伴们都知道&lt;code&gt;git&lt;/code&gt;有很多命令&lt;code&gt;commit&lt;/code&gt;、&lt;code&gt;push&lt;/code&gt;、&lt;code&gt;rebase&lt;/code&gt;等等。那这些命令主要是在执行&lt;code&gt;.git&lt;/code&gt;文件夹中的东西，那么&lt;code&gt;git&lt;/code&gt; 钩子目录就是在&lt;code&gt;.git&lt;/code&gt;文件夹的&lt;code&gt;hooks&lt;/code&gt;下，如下所示：&lt;/p&gt;
&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;cd .git/hooks&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;ls -l&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&quot;/images/page/husky/1.jpeg&quot; alt&gt;&lt;/p&gt;
&lt;p&gt;上图为各个钩子的案例脚本，可以把&lt;code&gt;sample&lt;/code&gt;去掉，直接编写&lt;code&gt;shell&lt;/code&gt;脚本来执行。&lt;br&gt;而前端的小伙伴们则可以用插件&lt;code&gt;husky&lt;/code&gt;与&lt;code&gt;pre-commit&lt;/code&gt;，来使钩子生效。&lt;br&gt;注意： 一般&lt;code&gt;.git&lt;/code&gt;为隐藏文件，可以把项目拖入IDE中查看,&lt;code&gt;.git&lt;/code&gt;文件里的内容一般不允许手动更改的。&lt;/p&gt;
    
    </summary>
    
    
      <category term="git" scheme="http://blog.html-js.site/tags/git/"/>
    
      <category term="前端工程化" scheme="http://blog.html-js.site/tags/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>node文件上传oss</title>
    <link href="http://blog.html-js.site/2021/08/20/node%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0oss/"/>
    <id>http://blog.html-js.site/2021/08/20/node文件上传oss/</id>
    <published>2021-08-20T06:32:19.000Z</published>
    <updated>2021-09-10T08:49:10.146Z</updated>
    
    <content type="html"><![CDATA[<p>闲话不多说，直接上代码<br><a id="more"></a></p><h3 id="web端"><a href="#web端" class="headerlink" title="web端"></a>web端</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// file.tsx.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> UploadProps: any = &#123;</span><br><span class="line">  name: <span class="string">'file'</span>,</span><br><span class="line">  action: <span class="string">"/file/upload/stream1.rjson"</span>, <span class="comment">// "/file/upload/file.rjson",</span></span><br><span class="line">  method: <span class="string">"POST"</span>,</span><br><span class="line">  listType: <span class="string">'picture'</span>,</span><br><span class="line">  showUploadList: <span class="literal">false</span>,</span><br><span class="line">  onChange: <span class="function">(<span class="params">info: any</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (info.file.status !== <span class="string">'uploading'</span>) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(info.file, info.fileList);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (info.file.status === <span class="string">'done'</span>) &#123;</span><br><span class="line">      <span class="comment">// this.setState(&#123;</span></span><br><span class="line">      <span class="comment">//   picUrl:info.file.response.data,</span></span><br><span class="line">      <span class="comment">// &#125;)</span></span><br><span class="line">      <span class="built_in">console</span>.log(info);</span><br><span class="line">      message.success(<span class="string">`上传成功`</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (info.file.status === <span class="string">'error'</span>) &#123;</span><br><span class="line">      message.error(<span class="string">`<span class="subst">$&#123;info.file.response.data&#125;</span> 上传失败`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> (</span><br><span class="line">  &lt;div className=<span class="string">"main JsErrorList"</span>&gt;</span><br><span class="line">    &lt;div className=<span class="string">"content-header"</span>&gt;</span><br><span class="line">      &lt;Upload &#123;...UploadProps&#125; &gt;</span><br><span class="line">        &lt;Button type=<span class="string">"primary"</span> &gt;</span><br><span class="line">            上传图片</span><br><span class="line">        &lt;<span class="regexp">/Button&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>Upload&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>div&gt;</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h3 id="node端"><a href="#node端" class="headerlink" title="node端"></a>node端</h3><h4 id="router"><a href="#router" class="headerlink" title="router"></a>router</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// router.ts</span></span><br><span class="line">router.post(<span class="string">'/file/upload/stream.rjson'</span>, controller.file.streamUpload);</span><br></pre></td></tr></table></figure><h4 id="配置config文件"><a href="#配置config文件" class="headerlink" title="配置config文件"></a>配置config文件</h4><p>config.default.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; EggAppConfig, EggAppInfo, PowerPartial &#125; <span class="keyword">from</span> <span class="string">'egg'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (appInfo: EggAppInfo) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> config = &#123;&#125; <span class="keyword">as</span> PowerPartial&lt;EggAppConfig&gt;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// override config from framework / plugin</span></span><br><span class="line">  <span class="comment">// use for cookie sign key, should change to your own and keep security</span></span><br><span class="line">  config.keys = appInfo.name + <span class="string">'_1626073505827_4266'</span>;</span><br><span class="line">  <span class="comment">// add your egg config in here</span></span><br><span class="line">  config.middleware = [];</span><br><span class="line"></span><br><span class="line">  config.security = &#123;</span><br><span class="line">    csrf: &#123;</span><br><span class="line">      enable: <span class="literal">false</span>,</span><br><span class="line">      ignoreJSON: <span class="literal">true</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    domainWhiteList: [ <span class="string">'*'</span> ],</span><br><span class="line">  &#125;;</span><br><span class="line">  config.cors = &#123;</span><br><span class="line">    origin: <span class="string">'*'</span>, <span class="comment">// 匹配规则  域名+端口  *则为全匹配</span></span><br><span class="line">    allowMethods: <span class="string">'GET,HEAD,PUT,POST,DELETE,PATCH'</span>,</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  config.multipart = &#123;</span><br><span class="line">    <span class="comment">// mode: 'file',</span></span><br><span class="line">    mode: <span class="string">'stream'</span>,</span><br><span class="line">    fieldSize: <span class="string">'50mb'</span>,</span><br><span class="line">    whitelist() &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment">// the return config will combines to EggAppConfig</span></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    ...config,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="文件保存本地"><a href="#文件保存本地" class="headerlink" title="文件保存本地"></a>文件保存本地</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Controller &#125; <span class="keyword">from</span> <span class="string">'egg'</span>;</span><br><span class="line"><span class="keyword">import</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"><span class="keyword">import</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">import</span> pump = <span class="built_in">require</span>(<span class="string">'mz-modules/pump'</span>);</span><br><span class="line"><span class="keyword">import</span> OSS = <span class="built_in">require</span>(<span class="string">'ali-oss'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> aliInfo = &#123;</span><br><span class="line">  region: <span class="string">'oss-cn-hangzhou'</span>,</span><br><span class="line">  bucket: <span class="string">'newbcdn'</span>,</span><br><span class="line">  accessKeyId: <span class="string">'81nVk8nRRQ3bmNju'</span>,</span><br><span class="line">  accessKeySecret: <span class="string">'oAoHvFpwYQXAqOOBTCfaAbmH12pT7i'</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">FilterController</span> <span class="keyword">extends</span> <span class="title">Controller</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> streamUpload() &#123;</span><br><span class="line">    <span class="keyword">const</span> stream = <span class="keyword">await</span> <span class="keyword">this</span>.ctx.getFileStream(); <span class="comment">// 获取stream</span></span><br><span class="line">    <span class="keyword">const</span> filename = stream.filename.toLowerCase(); <span class="comment">// 获取fieldname</span></span><br><span class="line">    <span class="comment">// 存储本地</span></span><br><span class="line">    <span class="keyword">const</span> target = path.join(<span class="keyword">this</span>.config.baseDir, <span class="string">'app/public/upload'</span>, filename); <span class="comment">// 生成目标地址</span></span><br><span class="line">    <span class="keyword">const</span> writeStream = fs.createWriteStream(target); <span class="comment">// 创建fs对象</span></span><br><span class="line">    <span class="keyword">await</span> pump(stream, writeStream); <span class="comment">// 保存文件</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// const url = '/'</span></span><br><span class="line">    <span class="keyword">this</span>.ctx.body = &#123;</span><br><span class="line">      result: <span class="number">200</span>,</span><br><span class="line">      message: <span class="string">'上传成功'</span>,</span><br><span class="line">      data: <span class="number">100</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="文件保存oss"><a href="#文件保存oss" class="headerlink" title="文件保存oss"></a>文件保存oss</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Controller &#125; <span class="keyword">from</span> <span class="string">'egg'</span>;</span><br><span class="line"><span class="keyword">import</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"><span class="keyword">import</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">import</span> pump = <span class="built_in">require</span>(<span class="string">'mz-modules/pump'</span>);</span><br><span class="line"><span class="keyword">import</span> OSS = <span class="built_in">require</span>(<span class="string">'ali-oss'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> aliInfo = &#123;</span><br><span class="line">  region: <span class="string">'oss-cn-hangzhou'</span>,</span><br><span class="line">  bucket: <span class="string">'newbcdn'</span>,</span><br><span class="line">  accessKeyId: <span class="string">'81nVk8nRRQ3bmNju'</span>,</span><br><span class="line">  accessKeySecret: <span class="string">'oAoHvFpwYQXAqOOBTCfaAbmH12pT7i'</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">FilterController</span> <span class="keyword">extends</span> <span class="title">Controller</span> </span>&#123;</span><br><span class="line">  <span class="comment">// stream 上传</span></span><br><span class="line">  <span class="keyword">async</span> streamUpload() &#123;</span><br><span class="line">    <span class="keyword">const</span> stream = <span class="keyword">await</span> <span class="keyword">this</span>.ctx.getFileStream();</span><br><span class="line">    <span class="keyword">const</span> filename = stream.filename.toLowerCase();</span><br><span class="line">    <span class="keyword">const</span> filePath = <span class="string">`cdn/<span class="subst">$&#123;filename&#125;</span>`</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 上传oss</span></span><br><span class="line">    <span class="keyword">let</span> result:any;</span><br><span class="line">    <span class="keyword">const</span> ossClient = <span class="keyword">new</span> OSS(aliInfo);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="comment">// https://help.aliyun.com/document_detail/111265.html</span></span><br><span class="line">      <span class="comment">// 处理文件，比如上传到云端</span></span><br><span class="line">      result = <span class="keyword">await</span> ossClient.putStream(filePath, stream);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(e);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// const url = '/'</span></span><br><span class="line">    <span class="keyword">this</span>.ctx.body = &#123;</span><br><span class="line">      result: <span class="number">200</span>,</span><br><span class="line">      message: <span class="string">'上传成功'</span>,</span><br><span class="line">      data: result.url,  <span class="comment">//http://newbcdn.oss-cn-hangzhou.aliyuncs.com/cdn/default_avatar_big.jpg</span></span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;闲话不多说，直接上代码&lt;br&gt;
    
    </summary>
    
    
      <category term="node" scheme="http://blog.html-js.site/tags/node/"/>
    
  </entry>
  
  <entry>
    <title>设计方案,写了才知道多香</title>
    <link href="http://blog.html-js.site/2021/08/18/%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%A1%88-%E5%86%99%E4%BA%86%E6%89%8D%E7%9F%A5%E9%81%93%E5%A4%9A%E9%A6%99/"/>
    <id>http://blog.html-js.site/2021/08/18/设计方案-写了才知道多香/</id>
    <published>2021-08-18T08:04:43.000Z</published>
    <updated>2021-09-02T14:39:09.531Z</updated>
    
    <content type="html"><![CDATA[<h3 id="设计方案，拿来吧你"><a href="#设计方案，拿来吧你" class="headerlink" title="设计方案，拿来吧你"></a>设计方案，拿来吧你</h3><p>今天要跟大家聊聊开发流程中不起眼的环节——<code>设计方案</code>。你们可能没听过，也可能只是简单得走过过场，别划走，这非常重要！</p><p>更完善、更规范、更高效的开发流程：<code>产品需求设计</code> =&gt; <code>需求粗评</code> =&gt; <code>做设计方案</code> =&gt; <code>粗估时</code> =&gt; <code>需求细评</code> =&gt; <code>排期</code> =&gt; <code>开发</code> =&gt; <code>提测、修bug</code> =&gt; <code>code review</code> =&gt; <code>上线</code></p><p>平常工作中，比较少接触的可能就是1和<code>code review</code>了，这两者分别是干什么的？</p><ul><li><code>设计方案</code>：在拿到需求后，写一个文档，来描述自己对于该需求的实现思路、模块划分等相关考虑的点，可供今后自己或他人查阅。</li><li><code>Code review</code>：代码提交合并前给mentor或leader检查一下你的代码，让别人作为旁观者来看你的代码，集思广益，完善代码，发现未考虑到的边界问题。</li></ul><a id="more"></a><p>说实话哈，啥设计方案啊，通常都是在工作时，突然就被产品叫过去，花5分钟给我阐述了一下下个版本他想要上的功能，紧接着立马就问我：<code>你看看大概需要多久？我的预估是5天后就上线，ok吗</code>？</p><p>我： <code>？？？？？？？？？</code> （内心os：我刚知道这个需求，我哪能那么快知道我得花多久做出来啊！你说5天就5天吧，反正我说6天也没用）</p><p><img src="/images/page/fangan/-1.png" alt></p><p>太离谱了，可能很多小公司的现状都是像我说的这样吧！这样真的很不好，版本快速迭代中掺杂着许多需求，而开发时间又比较紧张，只会让开发想尽办法怎么赶紧把功能实现，而不会去考虑任何性能问题，更别说让你考虑边界问题了。长期这样下去，你会深深地体会到你处于一个无止境的项目快速迭代中，加班、通宵可能都是常事，哪还会有时间去学习新的知识或做自己爱做的事，也不会有多余的时间去关注自己接手的需求从开发到上线的整个生命周期线，不会定期去复盘，因此个人的项目经验、技术积累是很少的</p><p>之前也有小伙伴私聊过我类似的情况，我也是建议他最好能在一个有「自我学习」、「定期复盘反省」的环境中工作</p><p>大圣老师就是如此，记得他在有次直播中讲到，他当年去360时，把「能留给自己充足的学习时间」作为他最在乎的因素，这样真的非常好。大家也可以看看自己当前的现状是否真的利于自己发展，然后做更长远的打算。</p><p>好了，言归正传！</p><h3 id="我们为什么要写设计方案呢"><a href="#我们为什么要写设计方案呢" class="headerlink" title="我们为什么要写设计方案呢"></a>我们为什么要写设计方案呢</h3><p>目的是为了在真正开始敲代码之前理清自己的思路，对需求有一个更清楚的认识，这样就不至于在开始开发后边写代码边思考了，想必你们都有遇到在写代码时突然发现哪一模块之前没考虑到，然后对之前写好的代码的架构进行调整，代码进行抽离，这无疑是在降低开发效率。</p><p>另一点就是时间一久，突然这个功能出现了一个bug让你去修复，你可能会对自己写的代码有些忘却，此时找到之前自己写的设计方案一看便知，这同样也能作为新入职的小伙伴在熟悉现有代码的重要资源！</p><p>对于第二点我深有感触，到一个新部门总会接手1~2个祖传项目代码，紧接着你就要阅读他们的代码逻辑，这是非常痛苦的，因为你根本不了解这些需求的背景，也不了解他人代码完整的设计思路，这不跟抱着一本厚书在那硬啃一样嘛！</p><p>要是之前的人都写过设计方案，你完全可以在看每个模块的时候，找到相应的文档，这不事半功倍嘛~</p><h3 id="那么如何写设计方案呢？"><a href="#那么如何写设计方案呢？" class="headerlink" title="那么如何写设计方案呢？"></a>那么如何写设计方案呢？</h3><p>整个方案大致分为4个部分：<code>需求相关信息</code>、<code>方案调研</code>、<code>具体方案</code>、<code>其它</code></p><h4 id="一、需求相关信息"><a href="#一、需求相关信息" class="headerlink" title="一、需求相关信息"></a>一、需求相关信息</h4><p>作为一个开发工程师，一定要有工程师的精神，需要对自己所接手的需求有清晰的认识，这包括：负责这个需求的其它相关人员分别是谁（产品、测试、UI、后端等）、我这个需求的出现背景是什么、需求何时提测，何时上线…</p><p>格式如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">一、需求相关信息</span><br><span class="line">​</span><br><span class="line">  需求背景：因为我们要做线下推广，提高xxxxxxxxx</span><br><span class="line">  PRD：文档链接</span><br><span class="line">  产品：小华</span><br><span class="line">  UI：小明</span><br><span class="line">  测试：小红</span><br><span class="line">  前端：零一</span><br><span class="line">  服务端：小张</span><br><span class="line">  联调时间：2021.07.30</span><br><span class="line">  提测时间：2021.07.31</span><br><span class="line">  上线时间：2021.08.10</span><br></pre></td></tr></table></figure><p>把这些内容写在设计方案的开头，让跟这个需求相关、不相关的人都能一目了然，如果遇到问题也可以立马精准地找到相应的人</p><p><img src="/images/page/fangan/0.png" alt></p><h4 id="二、方案调研"><a href="#二、方案调研" class="headerlink" title="二、方案调研"></a>二、方案调研</h4><p>这一部分主要是需要我们在考虑功能实现的技术选型时，对比很多不同的方案，综合考虑每一种方案的优缺点，可以适当地取舍和改进，形成一套适合当前场景的技术方案。</p><p>举个比较简单的例子吧，假设你此次接的需求中有一个复杂的动画要实现，那么你以下这几种考虑的方向</p><ul><li>以前我有没有做过类似的动画，可以借鉴的？</li><li>公司内部有没有什么现成的库或者代码能用？</li><li>业界有没有现成的库或者比较不错的实现思路？</li><li>如果不用别的库，用原生实现，我会怎么做？有没有什么兼容性等其它问题？</li></ul><p>在了解了这四种场景以后，我们此时需要思考别人的方案和我自己的方案哪一个更好，优缺点分别是什么？别人的方案是否适用于我们当前的场景？ 在综合考虑了众多因素后，我们选择一套相对比较靠谱的方案用于实行。</p><p>通过以上几个步骤来支撑我们接下来敲出来的代码的可靠性与质量！</p><h4 id="三、具体方案"><a href="#三、具体方案" class="headerlink" title="三、具体方案"></a>三、具体方案</h4><p>这部分是最重要的了，它几乎涵盖了你所有需要思考的东西：<code>业务的完整流程</code>、<code>数据结构的设计</code>、<code>关键功能的逻辑描述</code>、<code>异常的处理</code>、<code>安全性</code>、<code>性能</code>、<code>与现有业务的耦合情况</code>、<code>组件复用</code></p><p>起码要保证其他人以及你自己，在看到具体的方案介绍时，可以很清楚地明白你的设计思路、写代码的思路、模块的划分。你可以用任何形式去表达你的思路，例如伪代码、流程图或者纯文字等等.</p><p><code>流程图</code><br><img src="/images/page/fangan/1.png" alt></p><p>流程图的设计能让你对自己的需求有更清楚的了解，也能让他人对这个需求有一个直观的认识</p><p><code>伪代码</code><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getSomeData</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> data; </span><br><span class="line">  <span class="keyword">if</span>(无缓存) &#123;</span><br><span class="line">    <span class="comment">// 请求数据</span></span><br><span class="line">    <span class="keyword">if</span>(请求异常) <span class="comment">// 展示错误页面;</span></span><br><span class="line">    data = 请求到的数据;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 展示页面</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>伪代码可以在你不写具体代码实现前，展示大致的编码思路，那么在大家一起过你的设计方案时，就可以很清楚得知道你的代码想怎么实现，因为是伪代码，所以非技术的同学说不定也能看懂，然后给你提点意见呢！</p><p><img src="/images/page/fangan/2.png" alt></p><p>模块的划分也是考验你架构设计的一个点，你需要考虑清楚你的代码中，哪些需要单独抽离出来作为一个单独的模块，哪些可以作为公共组件，哪些是跟业务高耦合的</p><p><img src="/images/page/fangan/3.png" alt></p><p>用例图的话，能帮助你整理需求中每一个大大小小的场景，这个光靠脑子想可能没有太大的作用，当你列出来时，你可能会发现这个流程好像少了点什么东西，也就是有助于你考虑更全，关注到一些犄角旮旯的边界。插播个小彩蛋，我有个前端同事写用例写的特别好，有一次leader调侃说他这个写的也太太太详细了，每一处考虑得都特别周全，甚至都可以直接原封不动得给测试当测试用例了，hhhh</p><p>我所列举的例子都比较简单，大家根据自己实际情况进行操作就好。<br>还有一些别的就是，你还需要考虑一下你的<code>某些接口需不需要考虑安全问题</code>，比如点击submit会增加抽奖次数，那不会被别人恶意伪造一些信息进行刷抽奖次数呢？还有<code>你的页面会不会存在一些性能问题</code>？如果以后要在这个需求上扩展别的功能，<code>你觉得你的代码可扩展性如何</code>？当然，你要考虑的肯定远不止这些，希望每个工程师都能对自己的方案考虑周全，做到精益求精，这样才是一个合格的工程师！</p><h4 id="四、其它"><a href="#四、其它" class="headerlink" title="四、其它"></a>四、其它</h4><p>最后一部分完全可以留给你自己自由发挥，可以记录下与这个需求相关的一切，我个人觉得可以写的有这些：</p><ul><li>你在写设计方案时遇到的问题以及解决办法</li><li>你的代码上线以后，用户的反馈如何，如果好，好在哪里；如果不好，到底是哪里出了问题，该如何解决</li><li>你在方案调研时，有没有发现别人的方案哪里做的不好，或者有哪些值得学习的地方</li><li>在此次整个开发流程中，有觉得哪个流程不太好的（低效、无用的沟通等等），可以记录在此，然后找相关人员讨论改进</li><li>more…</li></ul><p>总之，这里随心所欲发挥<br><img src="/images/page/fangan/4.png" alt></p><h3 id="实践感受"><a href="#实践感受" class="headerlink" title="实践感受"></a>实践感受</h3><p>一开始让我写设计方案时我略微有些抗拒，就心里想着为啥写个代码还要先写文档，这不是在增加我的工作量嘛？<br>后来leader告诉我，写设计方案的时间不会算在我的开发时间内的，而是在开发时间之前，给我3~4天专门用来写设计方案（内心os：woc？这么爽！我写！我写！），这不香的要死嘛，于是我也就开始尝试写设计方案了</p><p><img src="/images/page/fangan/5.png" alt></p><p>在写的过程中发现，流程上我可能会发现一些同事们都没有考虑到的问题，这是站在开发的视角去看的，所以产品同学难免会遗漏一些点；而在case的梳理上我又偶尔会发现大家都没有考虑到的边界问题，可能是真的大家都没考虑到，也有可能是我的想法比较独特，但这都ok，在后面所有相关人员统一过我的设计方案的时候可以一起讨论出个对错。嗯，这些都是光凭脑袋想不一定能想到的，或者哪个瞬间想到了却来不及记录，到了开发的时候又给忘了！</p><p>等我设计方案写完以后，相关人员会约一个时间一起听我讲一遍我的设计方案，不同岗位的同学有不同的视角去看问题，每个人也有不同的想法，所以这里能暴露出很多问题，也能把很多不ok的点处理掉，例如我的leader经验比较丰富，每次过设计方案时他都会提醒我哪一块儿地方可能会存在安全问题，记得考虑一下。</p><p>再后来测试同学会整理一些测试用例，拉大家case评审，你之前做过了设计方案，对自己的需求非常熟悉了，那么在测试过你的需求的case时你会更加的明白，也许测试考虑到了你没考虑到的点，也许是他遗漏了某些点而你考虑到了，这些都是可以互补的。</p><p>完成了以上内容，基本上我写代码的思路就通了，确实也节省了不少的时间！等我开发完以后，还会再自测一遍，怎么测？直接拿我设计方案和测试给出来的测试用例对照着自测就好啦，总不能说你自己这里都还没跑通就拿过去给测试测吧？</p><p>总之收获还是很大，但设计方案的实施还是需要有一个不那么短的开发周期的，那种需求刚提，5天上线的情况哪有时间给你写设计方案啊，就更别说考虑这么多东西了，你自己个人也很难沉淀下东西<br>不过哦~我突然又发现了写设计方案的另外一个隐藏好处！我们的简历上不是会写上自己过往项目经验和工作经历嘛，这些都跟我们做过的项目需求紧密相关，你如果之前每个需求都写设计方案，那么写简历还用愁嘛，妥妥的筛选一下 + 复制粘贴啊</p><p><img src="/images/page/fangan/6.png" alt></p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;设计方案，拿来吧你&quot;&gt;&lt;a href=&quot;#设计方案，拿来吧你&quot; class=&quot;headerlink&quot; title=&quot;设计方案，拿来吧你&quot;&gt;&lt;/a&gt;设计方案，拿来吧你&lt;/h3&gt;&lt;p&gt;今天要跟大家聊聊开发流程中不起眼的环节——&lt;code&gt;设计方案&lt;/code&gt;。你们可能没听过，也可能只是简单得走过过场，别划走，这非常重要！&lt;/p&gt;
&lt;p&gt;更完善、更规范、更高效的开发流程：&lt;code&gt;产品需求设计&lt;/code&gt; =&amp;gt; &lt;code&gt;需求粗评&lt;/code&gt; =&amp;gt; &lt;code&gt;做设计方案&lt;/code&gt; =&amp;gt; &lt;code&gt;粗估时&lt;/code&gt; =&amp;gt; &lt;code&gt;需求细评&lt;/code&gt; =&amp;gt; &lt;code&gt;排期&lt;/code&gt; =&amp;gt; &lt;code&gt;开发&lt;/code&gt; =&amp;gt; &lt;code&gt;提测、修bug&lt;/code&gt; =&amp;gt; &lt;code&gt;code review&lt;/code&gt; =&amp;gt; &lt;code&gt;上线&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;平常工作中，比较少接触的可能就是1和&lt;code&gt;code review&lt;/code&gt;了，这两者分别是干什么的？&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;设计方案&lt;/code&gt;：在拿到需求后，写一个文档，来描述自己对于该需求的实现思路、模块划分等相关考虑的点，可供今后自己或他人查阅。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Code review&lt;/code&gt;：代码提交合并前给mentor或leader检查一下你的代码，让别人作为旁观者来看你的代码，集思广益，完善代码，发现未考虑到的边界问题。&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
    
      <category term="前端工程化" scheme="http://blog.html-js.site/tags/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>React Router源码解析</title>
    <link href="http://blog.html-js.site/2021/08/10/React-Router%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/"/>
    <id>http://blog.html-js.site/2021/08/10/React-Router源码解析/</id>
    <published>2021-08-10T09:06:00.000Z</published>
    <updated>2021-08-13T06:19:18.543Z</updated>
    
    <content type="html"><![CDATA[<p>我一直认为，会用框架和用好框架是有很大的区别的，当用框架到一定程度的时候，就需要看看框架对应生态中那些不可获取的库，这样能加深在不同框架中同样的功能的优秀实现方案。</p><blockquote><p>了解React Router的实现原理<br>如何监听路有变化以及渲染对应的组件</p></blockquote><h3 id="React-Router是什么？"><a href="#React-Router是什么？" class="headerlink" title="React Router是什么？"></a>React Router是什么？</h3><p>React Router是React团队开发的基于React框架架构所实现的路由库。</p><p><a href="https://link.zhihu.com/?target=https%3A//github.com/ReactTraining/react-router" target="_blank" rel="noopener">react-router</a></p><p>React Router有多个版本。</p><p><img src="/images/page/reactRouter2/1.png" alt></p><p><code>react-router-dom</code>是基于<code>react-router</code>再封装的一个带有<code>React DOM</code>组件的库，其中包括了<code>Link</code>、<code>HashRouter</code>、<code>BrowserRouter</code>等组件提供给开发者通过使用标签的方式控制路由跳转。</p><a id="more"></a><h3 id="阅读须知"><a href="#阅读须知" class="headerlink" title="阅读须知"></a>阅读须知</h3><ul><li>源码阅读基于react-router和react-router-dom 5.2.1版本</li></ul><h3 id="React-Router如何监听路由变化的？"><a href="#React-Router如何监听路由变化的？" class="headerlink" title="React Router如何监听路由变化的？"></a>React Router如何监听路由变化的？</h3><p><code>react-router</code>使用了一个<code>history</code>的库来监听不同的路由变化，<code>react-router</code>支持我们使用<code>hash</code>和<code>bowser</code>两种路由规则，所以<code>history</code>这个库可以根据调用的<code>api</code>不同，来区分当前是监听不同的路由方式。</p><p><a href="https://github.com/ReactTraining/history" target="_blank" rel="noopener">history</a></p><p><code>history</code>这个库的内容并不在本文章的阅读范围内，有兴趣的可以自行查看。</p><h3 id="源码解读"><a href="#源码解读" class="headerlink" title="源码解读"></a>源码解读</h3><p>我们开始逐步开始阅读源码。我们使用<code>React Router</code>的时候第一个了解的就是<code>BrowserRouter</code>和<code>HashRouter</code>这两个内置的组件。通过源码发现其实两个组件的实现是完全一样的，只是内部调用创建<code>history</code>实例的方式不一样，一个调用<code>createHashHistory</code>，另一个调用<code>createBrowserHistory</code>。</p><h3 id="官方demo"><a href="#官方demo" class="headerlink" title="官方demo"></a>官方demo</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  render () &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;Router&gt;</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">          &lt;ul&gt;</span><br><span class="line">            &lt;li&gt;</span><br><span class="line">              &lt;Link to=<span class="string">"/"</span>&gt;Home&lt;<span class="regexp">/Link&gt;</span></span><br><span class="line"><span class="regexp">            &lt;/</span>li&gt;</span><br><span class="line">            &lt;li&gt;</span><br><span class="line">              &lt;Link to=<span class="string">"/about"</span>&gt;About&lt;<span class="regexp">/Link&gt;</span></span><br><span class="line"><span class="regexp">            &lt;/</span>li&gt;</span><br><span class="line">            &lt;li&gt;</span><br><span class="line">              &lt;Link to=<span class="string">"/dashboard"</span>&gt;Dashboard&lt;<span class="regexp">/Link&gt;</span></span><br><span class="line"><span class="regexp">            &lt;/</span>li&gt;</span><br><span class="line">          &lt;<span class="regexp">/ul&gt;</span></span><br><span class="line"><span class="regexp">          &lt;hr /</span>&gt;</span><br><span class="line">          &lt;Route exact path=<span class="string">"/"</span>&gt;</span><br><span class="line">            &lt;Home /&gt;</span><br><span class="line">          &lt;<span class="regexp">/Route&gt;</span></span><br><span class="line"><span class="regexp">          &lt;Route path="/</span>about<span class="string">"&gt;</span></span><br><span class="line"><span class="string">            &lt;About /&gt;</span></span><br><span class="line"><span class="string">          &lt;/Route&gt;</span></span><br><span class="line"><span class="string">          &lt;Route path="</span>/dashboard<span class="string">"&gt;</span></span><br><span class="line"><span class="string">            &lt;Dashboard /&gt;</span></span><br><span class="line"><span class="string">          &lt;/Route&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">      &lt;/Router&gt;</span></span><br><span class="line"><span class="string">    );</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="BrowserRouter"><a href="#BrowserRouter" class="headerlink" title="BrowserRouter"></a>BrowserRouter</h3><!-- ![](/images/page/reactRouter2/2.jpeg) --><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// https://github.com/ReactTraining/react-router/blob/master/packages/react-router-dom/modules/BrowserRouter.js</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Router &#125; <span class="keyword">from</span> <span class="string">"react-router"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; createBrowserHistory <span class="keyword">as</span> createHistory &#125; <span class="keyword">from</span> <span class="string">"history"</span>;</span><br><span class="line"><span class="keyword">import</span> PropTypes <span class="keyword">from</span> <span class="string">"prop-types"</span>;</span><br><span class="line"><span class="keyword">import</span> warning <span class="keyword">from</span> <span class="string">"tiny-warning"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The public API for a &lt;Router&gt; that uses HTML5 history.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BrowserRouter</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  history = createHistory(<span class="keyword">this</span>.props);</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> &lt;Router history=&#123;this.history&#125; children=&#123;this.props.children&#125; /&gt;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> BrowserRouter;</span><br></pre></td></tr></table></figure><h3 id="HashRouter"><a href="#HashRouter" class="headerlink" title="HashRouter"></a>HashRouter</h3><!-- ![](/images/page/reactRouter2/3.jpeg) --><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// https://github.com/ReactTraining/react-router/blob/master/packages/react-router-dom/modules/HashRouter.js</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Router &#125; <span class="keyword">from</span> <span class="string">"react-router"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; createHashHistory <span class="keyword">as</span> createHistory &#125; <span class="keyword">from</span> <span class="string">"history"</span>;</span><br><span class="line"><span class="keyword">import</span> PropTypes <span class="keyword">from</span> <span class="string">"prop-types"</span>;</span><br><span class="line"><span class="keyword">import</span> warning <span class="keyword">from</span> <span class="string">"tiny-warning"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The public API for a &lt;Router&gt; that uses window.location.hash.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HashRouter</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  history = createHistory(<span class="keyword">this</span>.props);</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> &lt;Router history=&#123;this.history&#125; children=&#123;this.props.children&#125; /&gt;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> HashRouter;</span><br></pre></td></tr></table></figure><p>本篇文章是基于<code>HashRouter</code>进行阅读，实际上只是监听的事件不一样而已。</p><p>通过源码发现，<code>HashRouter</code>实例化了一个<code>history</code>的实例，并且将<code>history</code>实例通过<code>props</code>和<code>children</code>一起传入的<code>Router</code>组件当中。</p><h3 id="Router-组件"><a href="#Router-组件" class="headerlink" title="Router 组件"></a>Router 组件</h3><!-- ![](/images/page/reactRouter2/4.jpeg) --><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// https://github.com/ReactTraining/react-router/blob/master/packages/react-router/modules/Router.js</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> PropTypes <span class="keyword">from</span> <span class="string">"prop-types"</span>;</span><br><span class="line"><span class="keyword">import</span> warning <span class="keyword">from</span> <span class="string">"tiny-warning"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> HistoryContext <span class="keyword">from</span> <span class="string">"./HistoryContext.js"</span>;</span><br><span class="line"><span class="keyword">import</span> RouterContext <span class="keyword">from</span> <span class="string">"./RouterContext.js"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The public API for putting history on context.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Router</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> computeRootMatch(pathname) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">path</span>: <span class="string">"/"</span>, <span class="attr">url</span>: <span class="string">"/"</span>, <span class="attr">params</span>: &#123;&#125;, <span class="attr">isExact</span>: pathname === <span class="string">"/"</span> &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.state = &#123;</span><br><span class="line">      location: props.history.location</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// This is a bit of a hack. We have to start listening for location</span></span><br><span class="line">    <span class="comment">// changes here in the constructor in case there are any &lt;Redirect&gt;s</span></span><br><span class="line">    <span class="comment">// on the initial render. If there are, they will replace/push when</span></span><br><span class="line">    <span class="comment">// they mount and since cDM fires in children before parents, we may</span></span><br><span class="line">    <span class="comment">// get a new location before the &lt;Router&gt; is mounted.</span></span><br><span class="line">    <span class="keyword">this</span>._isMounted = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">this</span>._pendingLocation = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!props.staticContext) &#123;</span><br><span class="line">      <span class="keyword">this</span>.unlisten = props.history.listen(<span class="function"><span class="params">location</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>._isMounted) &#123;</span><br><span class="line">          <span class="keyword">this</span>.setState(&#123; location &#125;);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">this</span>._pendingLocation = location;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  componentDidMount() &#123;</span><br><span class="line">    <span class="keyword">this</span>._isMounted = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>._pendingLocation) &#123;</span><br><span class="line">      <span class="keyword">this</span>.setState(&#123; <span class="attr">location</span>: <span class="keyword">this</span>._pendingLocation &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  componentWillUnmount() &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.unlisten) &#123;</span><br><span class="line">      <span class="keyword">this</span>.unlisten();</span><br><span class="line">      <span class="keyword">this</span>._isMounted = <span class="literal">false</span>;</span><br><span class="line">      <span class="keyword">this</span>._pendingLocation = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;RouterContext.Provider</span><br><span class="line">        value=&#123;&#123;</span><br><span class="line">          history: <span class="keyword">this</span>.props.history,</span><br><span class="line">          location: <span class="keyword">this</span>.state.location,</span><br><span class="line">          match: Router.computeRootMatch(<span class="keyword">this</span>.state.location.pathname),</span><br><span class="line">          staticContext: <span class="keyword">this</span>.props.staticContext</span><br><span class="line">        &#125;&#125;</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;HistoryContext.Provider</span><br><span class="line">          children=&#123;<span class="keyword">this</span>.props.children || <span class="literal">null</span>&#125;</span><br><span class="line">          value=&#123;<span class="keyword">this</span>.props.history&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">      &lt;<span class="regexp">/RouterContext.Provider&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default Router;</span></span><br></pre></td></tr></table></figure><blockquote><p>computeRootMatch函数中，如果pathname !== “/“的下，isExact会为false，后续会用到</p></blockquote><h3 id="Route-组件"><a href="#Route-组件" class="headerlink" title="Route 组件"></a>Route 组件</h3><!-- ![](/images/page/reactRouter2/5.jpeg) --><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// https://github.com/ReactTraining/react-router/blob/master/packages/react-router/modules/Route.js</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; isValidElementType &#125; <span class="keyword">from</span> <span class="string">"react-is"</span>;</span><br><span class="line"><span class="keyword">import</span> PropTypes <span class="keyword">from</span> <span class="string">"prop-types"</span>;</span><br><span class="line"><span class="keyword">import</span> invariant <span class="keyword">from</span> <span class="string">"tiny-invariant"</span>;</span><br><span class="line"><span class="keyword">import</span> warning <span class="keyword">from</span> <span class="string">"tiny-warning"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> RouterContext <span class="keyword">from</span> <span class="string">"./RouterContext.js"</span>;</span><br><span class="line"><span class="keyword">import</span> matchPath <span class="keyword">from</span> <span class="string">"./matchPath.js"</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isEmptyChildren</span>(<span class="params">children</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> React.Children.count(children) === <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">evalChildrenDev</span>(<span class="params">children, props, path</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> value = children(props);</span><br><span class="line"></span><br><span class="line">  warning(</span><br><span class="line">    value !== <span class="literal">undefined</span>,</span><br><span class="line">    <span class="string">"You returned `undefined` from the `children` function of "</span> +</span><br><span class="line">      <span class="string">`&lt;Route<span class="subst">$&#123;path ? <span class="string">` path="<span class="subst">$&#123;path&#125;</span>"`</span> : <span class="string">""</span>&#125;</span>&gt;, but you `</span> +</span><br><span class="line">      <span class="string">"should have returned a React element or `null`"</span></span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> value || <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The public API for matching a single path and rendering.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Route</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;RouterContext.Consumer&gt;</span><br><span class="line">        &#123;context =&gt; &#123;</span><br><span class="line">          invariant(context, <span class="string">"You should not use &lt;Route&gt; outside a &lt;Router&gt;"</span>);</span><br><span class="line"></span><br><span class="line">          <span class="keyword">const</span> location = <span class="keyword">this</span>.props.location || context.location;</span><br><span class="line">          <span class="keyword">const</span> match = <span class="keyword">this</span>.props.computedMatch</span><br><span class="line">            ? <span class="keyword">this</span>.props.computedMatch <span class="comment">// &lt;Switch&gt; already computed the match for us</span></span><br><span class="line">            : <span class="keyword">this</span>.props.path</span><br><span class="line">            ? matchPath(location.pathname, <span class="keyword">this</span>.props)</span><br><span class="line">            : context.match;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">const</span> props = &#123; ...context, location, match &#125;;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">let</span> &#123; children, component, render &#125; = <span class="keyword">this</span>.props;</span><br><span class="line"></span><br><span class="line">          <span class="comment">// Preact uses an empty array as children by</span></span><br><span class="line">          <span class="comment">// default, so use null if that's the case.</span></span><br><span class="line">          <span class="keyword">if</span> (<span class="built_in">Array</span>.isArray(children) &amp;&amp; isEmptyChildren(children)) &#123;</span><br><span class="line">            children = <span class="literal">null</span>;</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">return</span> (</span><br><span class="line">            &lt;RouterContext.Provider value=&#123;props&#125;&gt;</span><br><span class="line">              &#123;props.match</span><br><span class="line">                ? children</span><br><span class="line">                  ? <span class="keyword">typeof</span> children === <span class="string">"function"</span></span><br><span class="line">                    ? __DEV__</span><br><span class="line">                      ? evalChildrenDev(children, props, <span class="keyword">this</span>.props.path)</span><br><span class="line">                      : children(props)</span><br><span class="line">                    : children</span><br><span class="line">                  : component</span><br><span class="line">                  ? React.createElement(component, props)</span><br><span class="line">                  : render</span><br><span class="line">                  ? render(props)</span><br><span class="line">                  : <span class="literal">null</span></span><br><span class="line">                : <span class="keyword">typeof</span> children === <span class="string">"function"</span></span><br><span class="line">                ? __DEV__</span><br><span class="line">                  ? evalChildrenDev(children, props, <span class="keyword">this</span>.props.path)</span><br><span class="line">                  : children(props)</span><br><span class="line">                : <span class="literal">null</span>&#125;</span><br><span class="line">            &lt;<span class="regexp">/RouterContext.Provider&gt;</span></span><br><span class="line"><span class="regexp">          );</span></span><br><span class="line"><span class="regexp">        &#125;&#125;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>RouterContext.Consumer&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Route;</span><br></pre></td></tr></table></figure><p>接下来我们看看<code>matchPath</code>函数是如何判断当前的<code>url</code>是否命中当前<code>Route</code>组件的<code>path</code>的。</p><p><img src="/images/page/reactRouter2/6.jpeg" alt></p><p>到这里，就是大概整体渲染的时候React Router做了什么事情。</p><p>总结：</p><ul><li>HashRouter</li><li><ul><li>实例化history，调用createHashHistory</li></ul></li><li><ul><li>将children和history传入Router组件</li></ul></li><li>Router</li><li><ul><li>constructor周期内监听history的路由事件，将新的location存到Router的state中</li></ul></li><li><ul><li>componentWillUnmount移除监听</li></ul></li><li><ul><li>使用Context包裹子组件（Provider），存入history、location、match(默认的命中对象)等。</li></ul></li><li>Route</li><li><ul><li>使用Context，声明为Consumer，接收Router传入的值。</li></ul></li><li><ul><li>调用matchPath函数来判断当前Route的path是否命中当前url。</li></ul></li><li><ul><li>使用Context包裹子组件（Provider），将Router传递进来的参数以及命中结果等传入给Route包裹的子组件</li></ul></li><li><ul><li>渲染循序如下：</li></ul></li><li><ul><li>当前Route是否命中url</li></ul></li><li><ul><li><ul><li>是</li></ul></li></ul></li><li><ul><li><ul><li><ul><li>判断当前Route是否有子组件，有那么将渲染子组件，否则进入下一条</li></ul></li></ul></li></ul></li><li><ul><li><ul><li><ul><li>判断当前Route是否有component参数，有就执行React.createElement创建component，否则进入下一条</li></ul></li></ul></li></ul></li><li><ul><li><ul><li><ul><li>判断当前Route是否有render参数（函数），有就执行render函数，否则进入下一条。</li></ul></li></ul></li></ul></li><li><ul><li><ul><li><ul><li>返回null</li></ul></li></ul></li></ul></li><li><ul><li><ul><li>否</li></ul></li></ul></li><li><ul><li><ul><li><ul><li>返回null</li></ul></li></ul></li></ul></li></ul><p>当我们的路由发生变化时，<code>Router</code>中所监听的<code>history</code>函数将会触发，返回新的<code>location</code>对象，这是将会触发<code>Router</code>的<code>setState</code>，然后对应所有绑定<code>Router</code>的<code>Route</code>都将会重新渲染判断是否命中路由来进行重新渲染。</p><h3 id="Switch-组件"><a href="#Switch-组件" class="headerlink" title="Switch 组件"></a>Switch 组件</h3><p>如果我们只是单纯的使用<code>Route</code>组件来设置路由，当我们的当前的<code>url</code>满足多条路由规则的情况下，会出现多个<code>Route</code>的子组件进行渲染，这个时候如果当我们使用<code>Switch</code>包裹多个<code>Route</code>组件的话，那么只会渲染首先命中当前<code>url</code>的<code>Route</code>组件，具体是如何实现的呢？</p><!-- ![](/images/page/reactRouter2/7.jpeg) --><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> PropTypes <span class="keyword">from</span> <span class="string">"prop-types"</span>;</span><br><span class="line"><span class="keyword">import</span> invariant <span class="keyword">from</span> <span class="string">"tiny-invariant"</span>;</span><br><span class="line"><span class="keyword">import</span> warning <span class="keyword">from</span> <span class="string">"tiny-warning"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> RouterContext <span class="keyword">from</span> <span class="string">"./RouterContext.js"</span>;</span><br><span class="line"><span class="keyword">import</span> matchPath <span class="keyword">from</span> <span class="string">"./matchPath.js"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The public API for rendering the first &lt;Route&gt; that matches.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Switch</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;RouterContext.Consumer&gt;</span><br><span class="line">        &#123;context =&gt; &#123;</span><br><span class="line">          invariant(context, <span class="string">"You should not use &lt;Switch&gt; outside a &lt;Router&gt;"</span>);</span><br><span class="line"></span><br><span class="line">          <span class="keyword">const</span> location = <span class="keyword">this</span>.props.location || context.location;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">let</span> element, match;</span><br><span class="line"></span><br><span class="line">          <span class="comment">// We use React.Children.forEach instead of React.Children.toArray().find()</span></span><br><span class="line">          <span class="comment">// here because toArray adds keys to all child elements and we do not want</span></span><br><span class="line">          <span class="comment">// to trigger an unmount/remount for two &lt;Route&gt;s that render the same</span></span><br><span class="line">          <span class="comment">// component at different URLs.</span></span><br><span class="line">          React.Children.forEach(<span class="keyword">this</span>.props.children, child =&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (match == <span class="literal">null</span> &amp;&amp; React.isValidElement(child)) &#123;</span><br><span class="line">              element = child;</span><br><span class="line"></span><br><span class="line">              <span class="keyword">const</span> path = child.props.path || child.props.from;</span><br><span class="line"></span><br><span class="line">              match = path</span><br><span class="line">                ? matchPath(location.pathname, &#123; ...child.props, path &#125;)</span><br><span class="line">                : context.match;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;);</span><br><span class="line"></span><br><span class="line">          <span class="keyword">return</span> match</span><br><span class="line">            ? React.cloneElement(element, &#123; location, <span class="attr">computedMatch</span>: match &#125;)</span><br><span class="line">            : <span class="literal">null</span>;</span><br><span class="line">        &#125;&#125;</span><br><span class="line">      &lt;<span class="regexp">/RouterContext.Consumer&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default Switch;</span></span><br></pre></td></tr></table></figure><p>所以<code>Switch</code>和<code>Route</code>的区别是在于，<code>Switch</code>只会渲染满足的条件的<code>Route</code>，而<code>Route</code>会根据传入的<code>path</code>来判断如果满足当前<code>url</code>的情况下，就会渲染<code>Route</code>的子组件。<code>Switch</code>就是从而实现<code>Route</code>同时只会命中一个的功能。</p><h3 id="Link-组件"><a href="#Link-组件" class="headerlink" title="Link 组件"></a>Link 组件</h3><p>Link组件也是相当简单的一个组件，内部主要做了以下事情：</p><ul><li>判断传入参数replace，是使用replace还是push进行跳转</li><li>执行传入的onClick事件</li><li>判断一些参数，例如（传入_blank参数，将交由浏览器处理）</li><li>触发内部点击事件，使用history库实例后的push或replace来控制前端路由跳转</li><li>禁止默认事件</li></ul><p>以下是Link组件的点击处理逻辑：</p><p><img src="/images/page/reactRouter2/8.jpeg" alt></p><p><code>Link</code>组件是如何获取到<code>history</code>的那，我们使用的时候并没有传递进去当前的<code>history</code>实例呀，实际上还记得之前看<code>Route</code>组件的时候，在<code>return</code>的时候，又包裹了一层<code>Context</code>吗，其实实际上就是给<code>Link</code>这类型的标签方便获取到<code>history</code>实例的，而<code>Link</code>组件也是使用<code>Context</code>。</p><p><img src="/images/page/reactRouter2/9.jpeg" alt></p><h3 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h3><p><code>React Router</code>的代码其实很好理解，主要涉及到的是<code>history</code>这个库是核心点，整个路由的触发事件的封装，抹平了浏览器差异。其次就是<code>React Router</code>实际是基于<code>context</code>来实现<code>Router</code>、<code>Route</code>、<code>Link</code>等组件中，<code>history</code>，<code>location</code>等值的传递。</p><!-- https://zhuanlan.zhihu.com/p/106042913 -->]]></content>
    
    <summary type="html">
    
      &lt;p&gt;我一直认为，会用框架和用好框架是有很大的区别的，当用框架到一定程度的时候，就需要看看框架对应生态中那些不可获取的库，这样能加深在不同框架中同样的功能的优秀实现方案。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;了解React Router的实现原理&lt;br&gt;如何监听路有变化以及渲染对应的组件&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;React-Router是什么？&quot;&gt;&lt;a href=&quot;#React-Router是什么？&quot; class=&quot;headerlink&quot; title=&quot;React Router是什么？&quot;&gt;&lt;/a&gt;React Router是什么？&lt;/h3&gt;&lt;p&gt;React Router是React团队开发的基于React框架架构所实现的路由库。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/ReactTraining/react-router&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;react-router&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;React Router有多个版本。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/page/reactRouter2/1.png&quot; alt&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;react-router-dom&lt;/code&gt;是基于&lt;code&gt;react-router&lt;/code&gt;再封装的一个带有&lt;code&gt;React DOM&lt;/code&gt;组件的库，其中包括了&lt;code&gt;Link&lt;/code&gt;、&lt;code&gt;HashRouter&lt;/code&gt;、&lt;code&gt;BrowserRouter&lt;/code&gt;等组件提供给开发者通过使用标签的方式控制路由跳转。&lt;/p&gt;
    
    </summary>
    
    
      <category term="react" scheme="http://blog.html-js.site/tags/react/"/>
    
      <category term="react-router" scheme="http://blog.html-js.site/tags/react-router/"/>
    
  </entry>
  
  <entry>
    <title>react-router-dom简介</title>
    <link href="http://blog.html-js.site/2021/08/05/react-router-dom%E7%AE%80%E4%BB%8B/"/>
    <id>http://blog.html-js.site/2021/08/05/react-router-dom简介/</id>
    <published>2021-08-05T05:47:32.000Z</published>
    <updated>2021-08-06T07:27:05.101Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://codesandbox.io/s/misty-haze-eq546?file=/example.js" target="_blank" rel="noopener">https://codesandbox.io/s/misty-haze-eq546?file=/example.js</a></p><p>react-router-dom</p><blockquote><p>react-router-dom文档地址： <a href="https://reactrouter.com/web/guides/quick-start/" target="_blank" rel="noopener">https://reactrouter.com/web/guides/quick-start/</a></p></blockquote><h3 id="1-安装"><a href="#1-安装" class="headerlink" title="1.安装"></a>1.安装</h3><blockquote><p>react-router提供多个包可以单独使用</p></blockquote><table><thead><tr><th style="text-align:center">package</th><th style="text-align:center">description</th></tr></thead><tbody><tr><td style="text-align:center">react-router</td><td style="text-align:center">路由核心功能</td></tr><tr><td style="text-align:center">react-router-dom</td><td style="text-align:center">基于react-router提供在浏览器运行环境下功能</td></tr><tr><td style="text-align:center">react-router-native</td><td style="text-align:center">for React Native</td></tr><tr><td style="text-align:center">react-router-config</td><td style="text-align:center">static route congif helpers</td></tr></tbody></table><p>在浏览器中运行只需要安装react-router-dom，reac-router-dom依赖react-router会自动安装依赖，所以不需要再手动安装react-router</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm install react-router-dom -S</span><br><span class="line"><span class="comment">// 或者</span></span><br><span class="line">yarn add react-router-dom</span><br></pre></td></tr></table></figure><a id="more"></a><h3 id="2-路由组件"><a href="#2-路由组件" class="headerlink" title="2.路由组件"></a>2.路由组件</h3><p>react-router包含三种类型的组件：路由组件、路由匹配组件 、导航组件。在你使用这些组件的时候，都必须先从react-router-dom引入。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  BrowserRouter <span class="keyword">as</span> Router,</span><br><span class="line">  Switch,</span><br><span class="line">  Route,</span><br><span class="line">  Link</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">"react-router-dom"</span>;</span><br></pre></td></tr></table></figure><h4 id="2-1路由组件"><a href="#2-1路由组件" class="headerlink" title="2.1路由组件"></a>2.1路由组件</h4><p>react-router提供了两种路由组件: <code>BrowserRouter</code>, <code>HashRouter</code> 其中 <code>BrowserRouter</code> 是基于HTML5 history API (<code>pushState</code>, <code>replaceState</code>, <code>popstate</code>)事件<br>当然与之对应的还有 <code>HashRouter</code> 是基于 <code>window.location.hash</code> 。</p><h4 id="2-2-路由匹配组件"><a href="#2-2-路由匹配组件" class="headerlink" title="2.2 路由匹配组件"></a>2.2 路由匹配组件</h4><p>路由匹配组件有两种: <code>Route</code> 和 <code>Switch</code>, <code>Switch</code> 把多个路由组合在一起。<br>对于一个 <code>&lt;Route&gt;</code> 组件，可以设置三种属性：<code>component</code>、<code>render</code>、<code>children</code>来渲染出对应的内容。<br>当组件已存在时，一般使用<code>component</code>属性当需要传递参数变量给组件时，需要使用<code>render</code>属性</p><h4 id="2-3-导航组件"><a href="#2-3-导航组件" class="headerlink" title="2.3 导航组件"></a>2.3 导航组件</h4><p>有三种常用的导航组件，分别是:<code>&lt;Link&gt;</code>、<code>&lt;NavLink&gt;</code>、<code>&lt;Redirect&gt;</code>。<code>&lt;NavLink&gt;</code>是一种特殊的Link组件，匹配路径时，渲染的a标签带有active。</p><h3 id="3-使用"><a href="#3-使用" class="headerlink" title="3. 使用"></a>3. 使用</h3><p>在需要使用router的地方引入react-router-dom</p><h4 id="3-1-基本使用"><a href="#3-1-基本使用" class="headerlink" title="3.1 基本使用"></a>3.1 基本使用</h4><p>以下是路由的基本使用例子</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  BrowserRouter <span class="keyword">as</span> Router,</span><br><span class="line">  Switch,</span><br><span class="line">  Route,</span><br><span class="line">  Link</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">"react-router-dom"</span>;</span><br><span class="line"><span class="comment">// import logo from './logo.svg';</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">'./App.css'</span>;</span><br><span class="line"><span class="keyword">import</span> About <span class="keyword">from</span> <span class="string">'./views/About'</span></span><br><span class="line"><span class="keyword">import</span> Home <span class="keyword">from</span> <span class="string">'./views/Home'</span></span><br><span class="line"><span class="keyword">import</span> Person <span class="keyword">from</span> <span class="string">'./views/Person'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;Router&gt;</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;nav&gt;</span><br><span class="line">          &lt;ul&gt;</span><br><span class="line">            &lt;li&gt;</span><br><span class="line">              &lt;Link to=<span class="string">"/"</span>&gt;Home&lt;<span class="regexp">/Link&gt;</span></span><br><span class="line"><span class="regexp">            &lt;/</span>li&gt;</span><br><span class="line">            &lt;li&gt;</span><br><span class="line">              &lt;Link to=<span class="string">"/about"</span>&gt;About&lt;<span class="regexp">/Link&gt;</span></span><br><span class="line"><span class="regexp">            &lt;/</span>li&gt;</span><br><span class="line">            &lt;li&gt;</span><br><span class="line">              &lt;Link to=<span class="string">"/person"</span>&gt;Person&lt;<span class="regexp">/Link&gt;</span></span><br><span class="line"><span class="regexp">            &lt;/</span>li&gt;</span><br><span class="line">          &lt;<span class="regexp">/ul&gt;</span></span><br><span class="line"><span class="regexp">        &lt;/</span>nav&gt;</span><br><span class="line"></span><br><span class="line">        &#123;<span class="comment">/* A &lt;Switch&gt; looks through its children &lt;Route&gt;s and</span></span><br><span class="line"><span class="comment">            renders the first one that matches the current URL. */</span>&#125;</span><br><span class="line">        &lt;Switch&gt;</span><br><span class="line">          &lt;Route path=<span class="string">"/about"</span>&gt;</span><br><span class="line">            &lt;About /&gt;</span><br><span class="line">          &lt;<span class="regexp">/Route&gt;</span></span><br><span class="line"><span class="regexp">          &lt;Route path="/</span>person<span class="string">"&gt;</span></span><br><span class="line"><span class="string">            &lt;Person /&gt;</span></span><br><span class="line"><span class="string">          &lt;/Route&gt;</span></span><br><span class="line"><span class="string">          &lt;Route path="</span>/<span class="string">"&gt;</span></span><br><span class="line"><span class="string">            &lt;Home /&gt;</span></span><br><span class="line"><span class="string">          &lt;/Route&gt;</span></span><br><span class="line"><span class="string">        &lt;/Switch&gt;</span></span><br><span class="line"><span class="string">      &lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;/Router&gt;</span></span><br><span class="line"><span class="string">  );</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">export default App;</span></span><br></pre></td></tr></table></figure><p>当然此处路由也可以有其他写法,比如</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;Switch&gt;</span><br><span class="line">  &lt;Route exact path=<span class="string">"/"</span> component=&#123;Home&#125;&gt;&lt;<span class="regexp">/Route&gt;</span></span><br><span class="line"><span class="regexp">  &lt;Route path="/</span>about<span class="string">" component=&#123;About&#125;&gt;&lt;/Route&gt;</span></span><br><span class="line"><span class="string">  &lt;Route path="</span>/person/:id<span class="string">" component=&#123;Person&#125;&gt;&lt;/Route&gt;</span></span><br><span class="line"><span class="string">  &lt;Route component=&#123;NotFind&#125;&gt;&lt;/Route&gt;</span></span><br><span class="line"><span class="string">&lt;/Switch&gt;</span></span><br></pre></td></tr></table></figure><p>其中的<code>exact</code>表示的是精确匹配，比如上面</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Route exact path=<span class="string">"/"</span> component=&#123;Home&#125;&gt;&lt;<span class="regexp">/Route&gt;</span></span><br></pre></td></tr></table></figure><p>如果没有写精确匹配的化，那么后面的所有路径都可以匹配到首页,解决方式就是增加exact或者将此路由放置最后面。</p><h4 id="3-2-Route动态传参"><a href="#3-2-Route动态传参" class="headerlink" title="3.2 Route动态传参"></a>3.2 Route动态传参</h4><p>在一个路由匹配组件上设置参数，比如说上面的Person组件</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Route path=<span class="string">"/person/:id"</span> component=&#123;Person&#125;&gt;&lt;<span class="regexp">/Route&gt;</span></span><br></pre></td></tr></table></figure><p>设置是以:开始然后紧跟key值，然后我们在Person组件中就可以通过获取props获取这个参数值</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.props.match.params.id)</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">const</span> id = <span class="keyword">this</span>.props.match.params.id</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;h2&gt;个人中心页面&lt;<span class="regexp">/h2&gt;</span></span><br><span class="line"><span class="regexp">        &lt;p&gt;个人id是:&#123;id&#125;&lt;/</span>p&gt;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    )</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p>以上为传统class组件的写法，现在可以使用hooks，可以使用<code>useParams</code>，代码如下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useParams &#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span></span><br><span class="line"><span class="keyword">const</span> Person = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; id &#125; = useParams();</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;h2&gt;个人中心页面&lt;<span class="regexp">/h2&gt;</span></span><br><span class="line"><span class="regexp">        &lt;p&gt;个人id是:&#123;id&#125;&lt;/</span>p&gt;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><h4 id="3-3-嵌套路由"><a href="#3-3-嵌套路由" class="headerlink" title="3.3 嵌套路由"></a>3.3 嵌套路由</h4><p>在About页面有一个嵌套路由代码示例：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Link, Switch, Route &#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span></span><br><span class="line"><span class="keyword">import</span> Tshirt <span class="keyword">from</span> <span class="string">'./product/Tshirt'</span>;</span><br><span class="line"><span class="keyword">import</span> Jeans <span class="keyword">from</span> <span class="string">'./product/Jeans'</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">About</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props)</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.props.match)</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">const</span> match = <span class="keyword">this</span>.props.match;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;&gt;</span><br><span class="line">    &lt;nav&gt;</span><br><span class="line">      &lt;Link to=&#123;<span class="string">`<span class="subst">$&#123;match.url&#125;</span>/tshirt`</span>&#125;&gt;Tshirt&lt;<span class="regexp">/Link&gt;| </span></span><br><span class="line"><span class="regexp">      &lt;Link to=&#123;`$&#123;match.url&#125;/</span>jeans<span class="string">`&#125;&gt;Jeans&lt;/Link&gt;</span></span><br><span class="line"><span class="string">    &lt;/nav&gt;</span></span><br><span class="line"><span class="string">    &lt;Switch&gt;</span></span><br><span class="line"><span class="string">      &lt;Route path=&#123;`</span>$&#123;match.path&#125;/tshirt<span class="string">`&#125; component=&#123;Tshirt&#125;&gt;&lt;/Route&gt;</span></span><br><span class="line"><span class="string">      &lt;Route path=&#123;`</span>$&#123;match.path&#125;/jeans<span class="string">`&#125; exact component=&#123;Jeans&#125;&gt;&lt;/Route&gt;</span></span><br><span class="line"><span class="string">    &lt;/Switch&gt;</span></span><br><span class="line"><span class="string">  &lt;/&gt;</span></span><br><span class="line"><span class="string">    )</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure><p>此处如果换成Function的话可以直接使用另一个钩子函数<code>useRouteMatch</code>，获取当前匹配的路径和路由</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useRouteMatch &#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span></span><br><span class="line"><span class="keyword">const</span> About = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; path, url &#125;  = useRouteMatch();</span><br><span class="line">    ...省略</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3-4-路由重定向"><a href="#3-4-路由重定向" class="headerlink" title="3.4 路由重定向"></a>3.4 路由重定向</h4><p><code>Redirect</code>路由重定向，使路由重定向到某个页面，比如我们经常会做的没有登录重定向到登录页面</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;Route exact path=<span class="string">"/"</span>&gt;</span><br><span class="line">  &#123;loggedIn ? &lt;Redirect to="/dashboard" /&gt; : &lt;PublicHomePage /&gt;&#125;&lt;<span class="regexp">/Route&gt;</span></span><br></pre></td></tr></table></figure><h4 id="3-5-滚动还原"><a href="#3-5-滚动还原" class="headerlink" title="3.5 滚动还原"></a>3.5 滚动还原</h4><p>大部分情况下，我们需要的是每次导航到某个新页面的的时候，滚动条都是在顶部,这种比较好实现</p><p>hooks版本</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; useEffect &#125; <span class="keyword">from</span> <span class="string">"react"</span>;<span class="keyword">import</span> &#123; useLocation &#125; <span class="keyword">from</span> <span class="string">"react-router-dom"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">ScrollToTop</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; pathname &#125; = useLocation();</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">window</span>.scrollTo(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">  &#125;, [pathname]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>class版本</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;<span class="keyword">import</span> &#123; withRouter &#125; <span class="keyword">from</span> <span class="string">"react-router-dom"</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ScrollToTop</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  componentDidUpdate(prevProps) &#123;</span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">      <span class="keyword">this</span>.props.location.pathname !== prevProps.location.pathname</span><br><span class="line">    ) &#123;</span><br><span class="line">      <span class="built_in">window</span>.scrollTo(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">  &#125;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>我们需要把<code>ScrollToTop</code>组件放在Router里面eg:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;Router&gt;</span><br><span class="line">      &lt;ScrollToTop /&gt;</span><br><span class="line">      &lt;App /&gt;</span><br><span class="line">    &lt;<span class="regexp">/Router&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p>而对于某些情况下比如一些tab我们希望切换回我们浏览过的tab页时我们希望滚动条滚动到我们之前浏览的位置，此处自行去实现。</p><h4 id="3-6-路由守卫"><a href="#3-6-路由守卫" class="headerlink" title="3.6 路由守卫"></a>3.6 路由守卫</h4><p>有时候我们在某个表单页面填好了表单，然后点击跳转到另外一个页面。<br>这时候我们就需要提醒用户有未提交的表单。当然这一步其实也是在实际的业务代码中实现。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; useState &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  Prompt</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">"react-router-dom"</span>;</span><br><span class="line"> <span class="keyword">const</span> BlockingForm = <span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">  <span class="keyword">let</span> [isBlocking, setIsBlocking] = useState(<span class="literal">false</span>);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;form</span><br><span class="line">      onSubmit=&#123;event =&gt; &#123;</span><br><span class="line">        event.preventDefault();</span><br><span class="line">        event.target.reset();</span><br><span class="line">        setIsBlocking(<span class="literal">false</span>);</span><br><span class="line">      &#125;&#125;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;Prompt</span><br><span class="line">        when=&#123;isBlocking&#125;</span><br><span class="line">        message=&#123;location =&gt;</span><br><span class="line">          <span class="string">`你是否要跳转到 <span class="subst">$&#123;location.pathname&#125;</span>`</span></span><br><span class="line">        &#125;</span><br><span class="line">      /&gt;</span><br><span class="line">      &lt;p&gt;</span><br><span class="line">        Blocking?&#123;<span class="string">" "</span>&#125;</span><br><span class="line">        &#123;isBlocking ? <span class="string">"Yes, click a link or the back button"</span> : <span class="string">"Nope"</span>&#125;</span><br><span class="line">      &lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">      &lt;p&gt;</span></span><br><span class="line"><span class="regexp">        &lt;input</span></span><br><span class="line"><span class="regexp">          size="50"</span></span><br><span class="line"><span class="regexp">          placeholder="输入值测试路由拦截"</span></span><br><span class="line"><span class="regexp">          onChange=&#123;event =&gt; &#123;</span></span><br><span class="line"><span class="regexp">            setIsBlocking(event.target.value.length &gt; 0);</span></span><br><span class="line"><span class="regexp">          &#125;&#125;</span></span><br><span class="line"><span class="regexp">        /</span>&gt;</span><br><span class="line">      &lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">      &lt;p&gt;</span></span><br><span class="line"><span class="regexp">        &lt;button&gt;提交表单模拟接触拦截&lt;/</span>button&gt;</span><br><span class="line">      &lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>form&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> BlockingForm;</span><br></pre></td></tr></table></figure><h4 id="3-7代码分割"><a href="#3-7代码分割" class="headerlink" title="3.7代码分割"></a>3.7代码分割</h4><p>有时候为了避免文件过大加快加载速度，我们需要将代码分割，将某些路由对应的组件只有在点击的时候再加载js，就是组件的懒加载。<br>我们使用<code>webpack</code>, <code>@babel/plugin-syntax-dynamic-import</code>,<code>loadable-components</code>实现代码分割。</p><ul><li>1.首先在.babelrc文件中增加配置</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"presets"</span>: [<span class="string">"@babel/preset-react"</span>],</span><br><span class="line">  <span class="string">"plugins"</span>: [<span class="string">"@babel/plugin-syntax-dynamic-import"</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>2.在我们需要懒加载的组件使用loadabel</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> loadable <span class="keyword">from</span> <span class="string">'@loadable/component'</span>;</span><br><span class="line"><span class="keyword">const</span> BlockForm = loadable(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'../pages/BlockForm/index'</span>), &#123;</span><br><span class="line">  fallback: &lt;Loading /&gt;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>其中BlockForm为懒加载得组件<br><code>loadable</code>参考文档地址 <a href="https://github.com/gregberge/loadable-components" target="_blank" rel="noopener">跳转</a></p><h4 id="3-8-withRouter"><a href="#3-8-withRouter" class="headerlink" title="3.8 withRouter"></a>3.8 withRouter</h4><p>您可以通过withRouter高阶组件访问history属性和匹配的Route,<br>withRouter will pass updated match, location, and history props to the wrapped component whenever it renders.</p><h4 id="3-9-其他hooks"><a href="#3-9-其他hooks" class="headerlink" title="3.9 其他hooks"></a>3.9 其他hooks</h4><p>之前使用了<code>useParams</code>和<code>useRouteMatch</code>两个hook,还有另外两个hook<br><code>useHistory</code>和<code>useLocation</code><br><code>useHistory</code><br>可以访问到history实例，我们可以通过这个实例访问某个路由<br><code>useLocation</code><br>返回location对象</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;a href=&quot;https://codesandbox.io/s/misty-haze-eq546?file=/example.js&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://codesandbox.io/s/misty-haze-eq546?file=/example.js&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;react-router-dom&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;react-router-dom文档地址： &lt;a href=&quot;https://reactrouter.com/web/guides/quick-start/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://reactrouter.com/web/guides/quick-start/&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;1-安装&quot;&gt;&lt;a href=&quot;#1-安装&quot; class=&quot;headerlink&quot; title=&quot;1.安装&quot;&gt;&lt;/a&gt;1.安装&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;react-router提供多个包可以单独使用&lt;/p&gt;
&lt;/blockquote&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&quot;text-align:center&quot;&gt;package&lt;/th&gt;
&lt;th style=&quot;text-align:center&quot;&gt;description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center&quot;&gt;react-router&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;路由核心功能&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center&quot;&gt;react-router-dom&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;基于react-router提供在浏览器运行环境下功能&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center&quot;&gt;react-router-native&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;for React Native&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center&quot;&gt;react-router-config&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;static route congif helpers&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;在浏览器中运行只需要安装react-router-dom，reac-router-dom依赖react-router会自动安装依赖，所以不需要再手动安装react-router&lt;/p&gt;
&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;npm install react-router-dom -S&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// 或者&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;yarn add react-router-dom&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="react" scheme="http://blog.html-js.site/tags/react/"/>
    
      <category term="react-router" scheme="http://blog.html-js.site/tags/react-router/"/>
    
  </entry>
  
  <entry>
    <title>react-router 深入学习</title>
    <link href="http://blog.html-js.site/2021/08/05/react-router-%E6%B7%B1%E5%85%A5%E5%AD%A6%E4%B9%A0/"/>
    <id>http://blog.html-js.site/2021/08/05/react-router-深入学习/</id>
    <published>2021-08-05T03:37:30.000Z</published>
    <updated>2021-08-10T09:12:18.903Z</updated>
    
    <content type="html"><![CDATA[<p>近期针对react-router的原理以及适用的场景有新的认知，会重新温习一遍react-router的使用方式以及适用场景，同时会延伸出一些实用的解决方案来解决项目中遇到的问题；</p><h3 id="思考的点"><a href="#思考的点" class="headerlink" title="思考的点"></a>思考的点</h3><ul><li>react-router的使用方式</li><li>react-router的原理</li><li>react一切皆组件 的理念</li><li>redux的实现原理</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;近期针对react-router的原理以及适用的场景有新的认知，会重新温习一遍react-router的使用方式以及适用场景，同时会延伸出一些实用的解决方案来解决项目中遇到的问题；&lt;/p&gt;
&lt;h3 id=&quot;思考的点&quot;&gt;&lt;a href=&quot;#思考的点&quot; class=&quot;heade
      
    
    </summary>
    
    
      <category term="react" scheme="http://blog.html-js.site/tags/react/"/>
    
      <category term="react-router" scheme="http://blog.html-js.site/tags/react-router/"/>
    
  </entry>
  
  <entry>
    <title>module.exports和exports和export和export default的区别，import和require的区别</title>
    <link href="http://blog.html-js.site/2021/03/26/module-exports%E5%92%8Cexports%E5%92%8Cexport%E5%92%8Cexport-default%E7%9A%84%E5%8C%BA%E5%88%AB%EF%BC%8Cimport%E5%92%8Crequire%E7%9A%84%E5%8C%BA%E5%88%AB/"/>
    <id>http://blog.html-js.site/2021/03/26/module-exports和exports和export和export-default的区别，import和require的区别/</id>
    <published>2021-03-26T06:09:08.000Z</published>
    <updated>2021-03-26T06:09:08.176Z</updated>
    
    <summary type="html">
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>module.exports和exports的区别</title>
    <link href="http://blog.html-js.site/2021/03/26/module-exports%E5%92%8Cexports%E7%9A%84%E5%8C%BA%E5%88%AB/"/>
    <id>http://blog.html-js.site/2021/03/26/module-exports和exports的区别/</id>
    <published>2021-03-26T06:08:57.000Z</published>
    <updated>2021-03-26T06:08:57.519Z</updated>
    
    <summary type="html">
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>判断数据类型的方法</title>
    <link href="http://blog.html-js.site/2021/03/22/%E5%88%A4%E6%96%AD%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E7%9A%84%E6%96%B9%E6%B3%95/"/>
    <id>http://blog.html-js.site/2021/03/22/判断数据类型的方法/</id>
    <published>2021-03-22T12:16:12.000Z</published>
    <updated>2021-03-22T12:16:45.477Z</updated>
    
    <content type="html"><![CDATA[<h3 id="1-Object-prototype-toString-call"><a href="#1-Object-prototype-toString-call" class="headerlink" title="1. Object.prototype.toString.call()"></a>1. Object.prototype.toString.call()</h3><p>每一个继承 Object 的对象都有 <code>toString</code> 方法，如果 <code>toString</code> 方法没有重写的话，会返回 <code>[Object type]</code>，其中 type 为对象的类型。但当除了 Object 类型的对象外，其他类型直接使用 <code>toString</code> 方法时，会直接返回都是内容的字符串，所以我们需要使用call或者apply方法来改变toString方法的执行上下文。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> an = [<span class="string">'Hello'</span>,<span class="string">'An'</span>];</span><br><span class="line">an.toString(); <span class="comment">// "Hello,An"</span></span><br><span class="line"><span class="built_in">Object</span>.prototype.toString.call(an); <span class="comment">// "[object Array]"</span></span><br></pre></td></tr></table></figure></p><p>这种方法对于所有基本的数据类型都能进行判断，即使是 null 和 undefined 。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Object</span>.prototype.toString.call(<span class="string">'An'</span>) <span class="comment">// "[object String]"</span></span><br><span class="line"><span class="built_in">Object</span>.prototype.toString.call(<span class="number">1</span>) <span class="comment">// "[object Number]"</span></span><br><span class="line"><span class="built_in">Object</span>.prototype.toString.call(<span class="built_in">Symbol</span>(<span class="number">1</span>)) <span class="comment">// "[object Symbol]"</span></span><br><span class="line"><span class="built_in">Object</span>.prototype.toString.call(<span class="literal">null</span>) <span class="comment">// "[object Null]"</span></span><br><span class="line"><span class="built_in">Object</span>.prototype.toString.call(<span class="literal">undefined</span>) <span class="comment">// "[object Undefined]"</span></span><br><span class="line"><span class="built_in">Object</span>.prototype.toString.call(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;) <span class="comment">// "[object Function]"</span></span><br><span class="line"><span class="built_in">Object</span>.prototype.toString.call(&#123;<span class="attr">name</span>: <span class="string">'An'</span>&#125;) <span class="comment">// "[object Object]"</span></span><br></pre></td></tr></table></figure></p><p>更多实现可见 <a href="https://juejin.im/post/591647550ce4630069df1c4a" target="_blank" rel="noopener">谈谈 Object.prototype.toString</a></p><a id="more"></a><h3 id="2-typeof"><a href="#2-typeof" class="headerlink" title="2.typeof"></a>2.typeof</h3><p>typeof是一个运算符，有2种使用方式：typeof(表达式)和typeof 变量名，第一种是对表达式做运算，第二种是对变量做运算。</p><p>typeof运算符的返回类型为字符串，值包括如下几种：        </p><ul><li>‘undefined’              –未定义的变量或值        </li><li>‘boolean’                 –布尔类型的变量或值        </li><li>‘string’                     –字符串类型的变量或值        </li><li>‘number’                  –数字类型的变量或值       </li><li>‘object’                    –对象类型的变量或值，或者null(这个是js历史遗留问题，将null作为object类型处理)        </li><li>‘function’                 –函数类型的变量或值</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> a);    <span class="comment">//'undefined'    </span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span>(<span class="literal">true</span>));  <span class="comment">//'boolean'    </span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> <span class="string">'123'</span>);  <span class="comment">//'string'    </span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> <span class="number">123</span>);   <span class="comment">//'number'    </span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> <span class="literal">NaN</span>);   <span class="comment">//'number'    </span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> <span class="literal">null</span>);  <span class="comment">//'object'        var obj = new String();    console.log(typeof(obj));    //'object'    var  fn = function()&#123;&#125;;    console.log(typeof(fn));  //'function'    </span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span>(<span class="class"><span class="keyword">class</span> <span class="title">c</span></span>&#123;&#125;));  <span class="comment">//'function'</span></span><br></pre></td></tr></table></figure><p>总结：typeof运算符用于判断对象的类型，但是对于一些创建的对象，它们都会返回’object’，有时我们需要判断该实例是否为某个对象的实例，那么这个时候需要用到instanceof运算符，后续记录instanceof运算符的相关用法。</p><h3 id="3-instanceof"><a href="#3-instanceof" class="headerlink" title="3. instanceof"></a>3. instanceof</h3><p><code>instanceof</code>  的内部机制是通过判断对象的原型链中是不是能找到类型的 <code>prototype</code>。</p><p><code>instanceof</code> 运算符只能用作对象的判断。</p><p>使用 <code>instanceof</code>判断一个对象是否为数组，<code>instanceof</code> 会判断这个对象的原型链上是否会找到对应的 <code>Array</code> 的原型，找到返回 <code>true</code>，否则返回 <code>false</code>。</p><p>但 <code>instanceof</code> 只能用来判断对象类型，原始类型不可以。并且所有对象类型 instanceof Object 都是 true。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[] <span class="keyword">instanceof</span> <span class="built_in">Array</span> <span class="comment">// true</span></span><br><span class="line">aa = &#123;<span class="attr">a</span>:<span class="number">1</span>&#125;</span><br><span class="line">aa <span class="keyword">instanceof</span> <span class="built_in">Object</span> <span class="comment">// true</span></span><br></pre></td></tr></table></figure></p><h3 id="4-Array-isArray"><a href="#4-Array-isArray" class="headerlink" title="4.Array.isArray()"></a>4.Array.isArray()</h3><ul><li>功能：用来判断对象是否为数组</li><li><p>instanceof 与 isArray<br>当检测Array实例时，<code>Array.isArray</code> 优于 <code>instanceof</code> ，因为 <code>Array.isArray</code> 可以检测出 <code>iframes</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> iframe = <span class="built_in">document</span>.createElement(<span class="string">'iframe'</span>);</span><br><span class="line"><span class="built_in">document</span>.body.appendChild(iframe);</span><br><span class="line">xArray = <span class="built_in">window</span>.frames[<span class="built_in">window</span>.frames.length<span class="number">-1</span>].Array;</span><br><span class="line"><span class="keyword">var</span> arr = <span class="keyword">new</span> xArray(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>); <span class="comment">// [1,2,3]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Correctly checking for Array</span></span><br><span class="line"><span class="built_in">Array</span>.isArray(arr);  <span class="comment">// true</span></span><br><span class="line"><span class="built_in">Object</span>.prototype.toString.call(arr); <span class="comment">// true</span></span><br><span class="line"><span class="comment">// Considered harmful, because doesn't work though iframes</span></span><br><span class="line">arr <span class="keyword">instanceof</span> <span class="built_in">Array</span>; <span class="comment">// false</span></span><br></pre></td></tr></table></figure></li><li><p>Array.isArray() 与 Object.prototype.toString.call()<br><code>Array.isArray()</code>是ES5新增的方法，当不存在 <code>Array.isArray()</code>，可以用 <code>Object.prototype.toString.call()</code> 实现。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!<span class="built_in">Array</span>.isArray) &#123;</span><br><span class="line">  <span class="built_in">Array</span>.isArray = <span class="function"><span class="keyword">function</span>(<span class="params">arg</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Object</span>.prototype.toString.call(arg) === <span class="string">'[object Array]'</span>;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;1-Object-prototype-toString-call&quot;&gt;&lt;a href=&quot;#1-Object-prototype-toString-call&quot; class=&quot;headerlink&quot; title=&quot;1. Object.prototype.toString.call()&quot;&gt;&lt;/a&gt;1. Object.prototype.toString.call()&lt;/h3&gt;&lt;p&gt;每一个继承 Object 的对象都有 &lt;code&gt;toString&lt;/code&gt; 方法，如果 &lt;code&gt;toString&lt;/code&gt; 方法没有重写的话，会返回 &lt;code&gt;[Object type]&lt;/code&gt;，其中 type 为对象的类型。但当除了 Object 类型的对象外，其他类型直接使用 &lt;code&gt;toString&lt;/code&gt; 方法时，会直接返回都是内容的字符串，所以我们需要使用call或者apply方法来改变toString方法的执行上下文。&lt;br&gt;&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; an = [&lt;span class=&quot;string&quot;&gt;&#39;Hello&#39;&lt;/span&gt;,&lt;span class=&quot;string&quot;&gt;&#39;An&#39;&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;an.toString(); &lt;span class=&quot;comment&quot;&gt;// &quot;Hello,An&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;Object&lt;/span&gt;.prototype.toString.call(an); &lt;span class=&quot;comment&quot;&gt;// &quot;[object Array]&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;这种方法对于所有基本的数据类型都能进行判断，即使是 null 和 undefined 。&lt;br&gt;&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;Object&lt;/span&gt;.prototype.toString.call(&lt;span class=&quot;string&quot;&gt;&#39;An&#39;&lt;/span&gt;) &lt;span class=&quot;comment&quot;&gt;// &quot;[object String]&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;Object&lt;/span&gt;.prototype.toString.call(&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;) &lt;span class=&quot;comment&quot;&gt;// &quot;[object Number]&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;Object&lt;/span&gt;.prototype.toString.call(&lt;span class=&quot;built_in&quot;&gt;Symbol&lt;/span&gt;(&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;)) &lt;span class=&quot;comment&quot;&gt;// &quot;[object Symbol]&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;Object&lt;/span&gt;.prototype.toString.call(&lt;span class=&quot;literal&quot;&gt;null&lt;/span&gt;) &lt;span class=&quot;comment&quot;&gt;// &quot;[object Null]&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;Object&lt;/span&gt;.prototype.toString.call(&lt;span class=&quot;literal&quot;&gt;undefined&lt;/span&gt;) &lt;span class=&quot;comment&quot;&gt;// &quot;[object Undefined]&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;Object&lt;/span&gt;.prototype.toString.call(&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;)&lt;/span&gt;&amp;#123;&amp;#125;) &lt;span class=&quot;comment&quot;&gt;// &quot;[object Function]&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;Object&lt;/span&gt;.prototype.toString.call(&amp;#123;&lt;span class=&quot;attr&quot;&gt;name&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&#39;An&#39;&lt;/span&gt;&amp;#125;) &lt;span class=&quot;comment&quot;&gt;// &quot;[object Object]&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;更多实现可见 &lt;a href=&quot;https://juejin.im/post/591647550ce4630069df1c4a&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;谈谈 Object.prototype.toString&lt;/a&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="javascript" scheme="http://blog.html-js.site/tags/javascript/"/>
    
  </entry>
  
  <entry>
    <title>浏览器输入 URL 后发生了什么</title>
    <link href="http://blog.html-js.site/2021/03/18/%E6%B5%8F%E8%A7%88%E5%99%A8%E8%BE%93%E5%85%A5-URL-%E5%90%8E%E5%8F%91%E7%94%9F%E4%BA%86%E4%BB%80%E4%B9%88/"/>
    <id>http://blog.html-js.site/2021/03/18/浏览器输入-URL-后发生了什么/</id>
    <published>2021-03-18T02:58:43.000Z</published>
    <updated>2021-03-18T02:59:17.748Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://zhuanlan.zhihu.com/p/43369093" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/43369093</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/43369093&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://zhuanlan.zhihu.com/p/43369093&lt;/a&gt;&lt;/p&gt;

      
    
    </summary>
    
    
      <category term="js" scheme="http://blog.html-js.site/tags/js/"/>
    
      <category term="html" scheme="http://blog.html-js.site/tags/html/"/>
    
  </entry>
  
  <entry>
    <title>AntD Modal组件的实现原理</title>
    <link href="http://blog.html-js.site/2021/03/16/AntD-Modal%E7%BB%84%E4%BB%B6%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86-1/"/>
    <id>http://blog.html-js.site/2021/03/16/AntD-Modal组件的实现原理-1/</id>
    <published>2021-03-16T03:37:50.000Z</published>
    <updated>2021-03-17T06:26:59.298Z</updated>
    
    <content type="html"><![CDATA[<p>Ant Design(AntD)是React的一种UI组件。开发中使用AntD的Modal,在处理用户处理事务,在当前页面弹出一个对话框,承载相应的操作。现在来看看AntD的实现原理</p><p>先写列出部分Modal基本用法:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;Button type=<span class="string">"primary"</span> onClick=&#123;<span class="keyword">this</span>.showModal&#125;&gt;Open a modal dialog&lt;<span class="regexp">/Button&gt;</span></span><br><span class="line"><span class="regexp">        &lt;Modal title="Basic Modal" visible=&#123;this.state.visible&#125;</span></span><br><span class="line"><span class="regexp">          onOk=&#123;this.handleOk&#125; onCancel=&#123;this.handleCancel&#125;</span></span><br><span class="line"><span class="regexp">        &gt;</span></span><br><span class="line"><span class="regexp">          &lt;p&gt;some contents...&lt;/</span>p&gt;</span><br><span class="line">          &lt;p&gt;some contents...&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">          &lt;p&gt;some contents...&lt;/</span>p&gt;</span><br><span class="line">        &lt;<span class="regexp">/Modal&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">//----------------</span></span><br><span class="line">ReactDOM.render(&lt;App /&gt;,mountNode)</span><br></pre></td></tr></table></figure><p>这样即可使用模态对话框组件。<br>打开浏览器的开发者功能可以看到对话框的div始终在body内层中，而不是在mountNode内部。当然模态对话框本就应该存在body内存中，而不是任意其他组件元素内部,否则嵌套效果不好，添加动画会招来性能问题。<br><a id="more"></a><br>这是为什么？<br>从AntD的Modal组件源码中(components/modal/index.tsx)，可以看到如下代码：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> confirm <span class="keyword">from</span> <span class="string">'./confirm'</span>;</span><br><span class="line">Modal.success = <span class="function"><span class="keyword">function</span> (<span class="params">props: ModalFuncProps</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> config = assign(&#123;&#125;, &#123;</span><br><span class="line">    type: <span class="string">'success'</span>,</span><br><span class="line">    iconType: <span class="string">'check-circle'</span>,</span><br><span class="line">    okCancel: <span class="literal">false</span>,</span><br><span class="line">  &#125;, props);</span><br><span class="line">  <span class="keyword">return</span> confirm(config);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>当Modal加载成功后，还需要进一步从confirm(config)获取组件。<br>我们进一步查看confirm,在confirm.tsx(components/modal/confirm.tsx)可以看到如下源码</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> div = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>);</span><br><span class="line"><span class="built_in">document</span>.body.appendChild(div);</span><br><span class="line"><span class="comment">//......</span></span><br><span class="line">ReactDOM.render(</span><br><span class="line">  &lt;Dialog</span><br><span class="line">    className=&#123;classString&#125;</span><br><span class="line">    onCancel=&#123;close.bind(<span class="keyword">this</span>, &#123; <span class="attr">triggerCancel</span>: <span class="literal">true</span> &#125;)&#125;</span><br><span class="line">    visible</span><br><span class="line">    title=<span class="string">""</span></span><br><span class="line">    transitionName=<span class="string">"zoom"</span></span><br><span class="line">    footer=<span class="string">""</span></span><br><span class="line">    maskTransitionName=<span class="string">"fade"</span></span><br><span class="line">    maskClosable=&#123;maskClosable&#125;</span><br><span class="line">    style=&#123;style&#125;</span><br><span class="line">    width=&#123;width&#125;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;div className=&#123;<span class="string">`<span class="subst">$&#123;prefixCls&#125;</span>-body-wrapper`</span>&#125;&gt;</span><br><span class="line">      &#123;body&#125; &#123;footer&#125;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>Dialog&gt;</span><br><span class="line">, div);</span><br></pre></td></tr></table></figure><p>最后再次使用ReactDOM.render()在创建的div内部添加对话框。<br>同时这是说明,ReactDOM.render()并不是只有在顶层要嵌入的div中使用。内部同样可以再次使用。</p><p>！！！但是，ReactDOM.render()方法，虽然可以实现组件的挂载点脱离父组件，但是组件的事件无法通过冒泡机制传递给父组件，也就是说如果挂载点div脱离了顶层root组件(<code>&lt;App /&gt;</code>)，那么挂载在div上面的组件也没办法使用redux。</p><p>那么为什么Antd-Modal到底是怎么实现的呢？ 原因是Antd-Modal里面使用了<a href="https://github.com/react-component/dialog" target="_blank" rel="noopener">rc-dialog</a> 组件，里面的<code>DialogWrap</code>组件使用了<a href="https://github.com/react-component/util" target="_blank" rel="noopener">rc-util</a>这个库的<a href="https://github.com/react-component/util/blob/master/src/ContainerRender.js" target="_blank" rel="noopener">ContainerRender.js</a>和<a href="https://github.com/react-component/util/blob/master/src/Portal.js" target="_blank" rel="noopener">Portal.js</a>方法，这个库解决了 ‘组件的挂载点虽然可以脱离父组件，但组件的事件通过冒泡机制仍可以传给父组件’ 问题</p><p>详情请看下一篇博客&gt;&gt;</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Ant Design(AntD)是React的一种UI组件。开发中使用AntD的Modal,在处理用户处理事务,在当前页面弹出一个对话框,承载相应的操作。现在来看看AntD的实现原理&lt;/p&gt;
&lt;p&gt;先写列出部分Modal基本用法:&lt;/p&gt;
&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;render() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; (&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;lt;div&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;lt;Button type=&lt;span class=&quot;string&quot;&gt;&quot;primary&quot;&lt;/span&gt; onClick=&amp;#123;&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.showModal&amp;#125;&amp;gt;Open a modal dialog&amp;lt;&lt;span class=&quot;regexp&quot;&gt;/Button&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;regexp&quot;&gt;        &amp;lt;Modal title=&quot;Basic Modal&quot; visible=&amp;#123;this.state.visible&amp;#125;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;regexp&quot;&gt;          onOk=&amp;#123;this.handleOk&amp;#125; onCancel=&amp;#123;this.handleCancel&amp;#125;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;regexp&quot;&gt;        &amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;regexp&quot;&gt;          &amp;lt;p&amp;gt;some contents...&amp;lt;/&lt;/span&gt;p&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &amp;lt;p&amp;gt;some contents...&amp;lt;&lt;span class=&quot;regexp&quot;&gt;/p&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;regexp&quot;&gt;          &amp;lt;p&amp;gt;some contents...&amp;lt;/&lt;/span&gt;p&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;lt;&lt;span class=&quot;regexp&quot;&gt;/Modal&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;regexp&quot;&gt;      &amp;lt;/&lt;/span&gt;div&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    );&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//----------------&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;ReactDOM.render(&amp;lt;App /&amp;gt;,mountNode)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;这样即可使用模态对话框组件。&lt;br&gt;打开浏览器的开发者功能可以看到对话框的div始终在body内层中，而不是在mountNode内部。当然模态对话框本就应该存在body内存中，而不是任意其他组件元素内部,否则嵌套效果不好，添加动画会招来性能问题。&lt;br&gt;
    
    </summary>
    
    
      <category term="react" scheme="http://blog.html-js.site/tags/react/"/>
    
  </entry>
  
  <entry>
    <title>前端实现公式解析</title>
    <link href="http://blog.html-js.site/2021/03/11/%E5%89%8D%E7%AB%AF%E5%AE%9E%E7%8E%B0%E5%85%AC%E5%BC%8F%E8%A7%A3%E6%9E%90/"/>
    <id>http://blog.html-js.site/2021/03/11/前端实现公式解析/</id>
    <published>2021-03-11T13:15:07.000Z</published>
    <updated>2021-03-11T13:20:44.404Z</updated>
    
    <content type="html"><![CDATA[<h3 id="1-认识-Function"><a href="#1-认识-Function" class="headerlink" title="1.认识 Function"></a>1.认识 Function</h3><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank" rel="noopener">mdn-Function介绍</a></p><p>我们先来看一行代码<br>这是js最基本的用法，用函数来输出表达式<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'哈哈哈'</span>)</span><br><span class="line">&#125;</span><br><span class="line">fn() <span class="comment">// 哈哈哈</span></span><br></pre></td></tr></table></figure></p><p>我们稍微变一下形<br>在之前的js函数篇分析中我有提过函数也是可以用构造函数Function 来创建<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fn = <span class="keyword">new</span> <span class="built_in">Function</span>(<span class="string">` console.log('哈哈哈') `</span>)</span><br><span class="line">fn() <span class="comment">// 哈哈哈</span></span><br></pre></td></tr></table></figure></p><p>看到这里也行你明白了点什么，如果没有也没关系，我们接着向下看<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> str = <span class="string">'哈哈哈'</span></span><br><span class="line"><span class="keyword">var</span> fn = <span class="keyword">new</span> <span class="built_in">Function</span>(<span class="string">` console.log(str) `</span>)</span><br><span class="line">fn() <span class="comment">// 哈哈哈</span></span><br></pre></td></tr></table></figure></p><p>再来复杂一点<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> str = <span class="string">'哈哈哈'</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">cons</span> (<span class="params">s</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(s)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> fn = <span class="keyword">new</span> <span class="built_in">Function</span>(<span class="string">` cons(str) `</span>)</span><br><span class="line">fn() <span class="comment">// 哈哈哈</span></span><br></pre></td></tr></table></figure></p><p>结合项目中<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> codemirrorText = <span class="string">'LEN(text_1)'</span> <span class="comment">// 设置的公司表达式</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> text_1 = <span class="string">'哈哈哈'</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">LEN</span> (<span class="params">s</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(s.length)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> fn = <span class="keyword">new</span> <span class="built_in">Function</span>(<span class="string">`return <span class="subst">$&#123;codemirrorText&#125;</span> `</span>)</span><br><span class="line">fn() <span class="comment">// 3</span></span><br></pre></td></tr></table></figure></p><p>github 公式解析库<br><a href="https://github.com/WangYang-Rex/formula" target="_blank" rel="noopener">formula</a></p><a id="more"></a>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;1-认识-Function&quot;&gt;&lt;a href=&quot;#1-认识-Function&quot; class=&quot;headerlink&quot; title=&quot;1.认识 Function&quot;&gt;&lt;/a&gt;1.认识 Function&lt;/h3&gt;&lt;p&gt;&lt;a href=&quot;https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;mdn-Function介绍&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;我们先来看一行代码&lt;br&gt;这是js最基本的用法，用函数来输出表达式&lt;br&gt;&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;fn&lt;/span&gt; (&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;built_in&quot;&gt;console&lt;/span&gt;.log(&lt;span class=&quot;string&quot;&gt;&#39;哈哈哈&#39;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;fn() &lt;span class=&quot;comment&quot;&gt;// 哈哈哈&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;我们稍微变一下形&lt;br&gt;在之前的js函数篇分析中我有提过函数也是可以用构造函数Function 来创建&lt;br&gt;&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; fn = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;Function&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;` console.log(&#39;哈哈哈&#39;) `&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;fn() &lt;span class=&quot;comment&quot;&gt;// 哈哈哈&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;看到这里也行你明白了点什么，如果没有也没关系，我们接着向下看&lt;br&gt;&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; str = &lt;span class=&quot;string&quot;&gt;&#39;哈哈哈&#39;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; fn = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;Function&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;` console.log(str) `&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;fn() &lt;span class=&quot;comment&quot;&gt;// 哈哈哈&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;再来复杂一点&lt;br&gt;&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; str = &lt;span class=&quot;string&quot;&gt;&#39;哈哈哈&#39;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;cons&lt;/span&gt; (&lt;span class=&quot;params&quot;&gt;s&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;built_in&quot;&gt;console&lt;/span&gt;.log(s)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; fn = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;Function&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;` cons(str) `&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;fn() &lt;span class=&quot;comment&quot;&gt;// 哈哈哈&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;结合项目中&lt;br&gt;&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; codemirrorText = &lt;span class=&quot;string&quot;&gt;&#39;LEN(text_1)&#39;&lt;/span&gt; &lt;span class=&quot;comment&quot;&gt;// 设置的公司表达式&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; text_1 = &lt;span class=&quot;string&quot;&gt;&#39;哈哈哈&#39;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;LEN&lt;/span&gt; (&lt;span class=&quot;params&quot;&gt;s&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;built_in&quot;&gt;console&lt;/span&gt;.log(s.length)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; fn = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;Function&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;`return &lt;span class=&quot;subst&quot;&gt;$&amp;#123;codemirrorText&amp;#125;&lt;/span&gt; `&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;fn() &lt;span class=&quot;comment&quot;&gt;// 3&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;github 公式解析库&lt;br&gt;&lt;a href=&quot;https://github.com/WangYang-Rex/formula&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;formula&lt;/a&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="javascript" scheme="http://blog.html-js.site/tags/javascript/"/>
    
  </entry>
  
  <entry>
    <title>在线调试工具-eruda</title>
    <link href="http://blog.html-js.site/2019/07/04/%E5%9C%A8%E7%BA%BF%E8%B0%83%E8%AF%95%E5%B7%A5%E5%85%B7-eruda/"/>
    <id>http://blog.html-js.site/2019/07/04/在线调试工具-eruda/</id>
    <published>2019-07-04T12:30:56.000Z</published>
    <updated>2021-03-12T08:42:09.610Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Eruda-一个被人遗忘的调试神器"><a href="#Eruda-一个被人遗忘的调试神器" class="headerlink" title="Eruda 一个被人遗忘的调试神器"></a>Eruda 一个被人遗忘的调试神器</h3><p>项目中如何引入？直接上代码<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">debugInit</span>(<span class="params">type</span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'debugInit'</span>)</span><br><span class="line"><span class="keyword">var</span> debug = sessionStorage.getItem(<span class="string">'debug'</span>) || type || <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">if</span>(location.href &amp;&amp; (location.href.includes(<span class="string">'debug'</span>) || location.href.includes(<span class="string">'dingnianhuiapp.superboss.cc'</span>))) &#123;</span><br><span class="line">debug = <span class="literal">true</span>;</span><br><span class="line"><span class="built_in">window</span>._debug = <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(debug) &#123;</span><br><span class="line"><span class="keyword">var</span> script = <span class="built_in">document</span>.createElement(<span class="string">'script'</span>); </span><br><span class="line">    <span class="comment">// script.src="https://dingtalkcdn.superboss.cc/nianhui/front/pc/vconsole.min.js"; </span></span><br><span class="line">    script.src=<span class="string">"//cdn.bootcss.com/eruda/1.5.2/eruda.min.js"</span>; </span><br><span class="line"><span class="built_in">document</span>.body.appendChild(script); </span><br><span class="line">script.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; </span><br><span class="line">      <span class="comment">// window.vConsole = new VConsole();</span></span><br><span class="line">      eruda.init();</span><br><span class="line">&#125;</span><br><span class="line">sessionStorage.setItem(<span class="string">'debug'</span>, <span class="literal">true</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">debugInit()</span><br></pre></td></tr></table></figure></p><p><a href="https://my.oschina.net/u/4293553/blog/3708333" target="_blank" rel="noopener">Eruda 一个被人遗忘的调试神器</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;Eruda-一个被人遗忘的调试神器&quot;&gt;&lt;a href=&quot;#Eruda-一个被人遗忘的调试神器&quot; class=&quot;headerlink&quot; title=&quot;Eruda 一个被人遗忘的调试神器&quot;&gt;&lt;/a&gt;Eruda 一个被人遗忘的调试神器&lt;/h3&gt;&lt;p&gt;项目中如何引入？直接
      
    
    </summary>
    
    
      <category term="javascript" scheme="http://blog.html-js.site/tags/javascript/"/>
    
  </entry>
  
  <entry>
    <title>2019年Web前端入门的自学路线</title>
    <link href="http://blog.html-js.site/2019/05/13/2019%E5%B9%B4Web%E5%89%8D%E7%AB%AF%E5%85%A5%E9%97%A8%E7%9A%84%E8%87%AA%E5%AD%A6%E8%B7%AF%E7%BA%BF/"/>
    <id>http://blog.html-js.site/2019/05/13/2019年Web前端入门的自学路线/</id>
    <published>2019-05-13T08:37:43.000Z</published>
    <updated>2021-03-17T06:30:25.414Z</updated>
    
    <content type="html"><![CDATA[<h3 id="2019年Web前端入门的自学路线"><a href="#2019年Web前端入门的自学路线" class="headerlink" title="2019年Web前端入门的自学路线"></a>2019年Web前端入门的自学路线</h3><blockquote><p>新手入门前端，需要学习的基础内容有很多，如下。</p></blockquote><p>一、HTML、CSS基础、JavaScript语法基础。学完基础后，可以仿照电商网站（例如京东、小米）做首页的布局。</p><p>二、JavaScript语法进阶。包括：作用域和闭包、this和对象原型等。相信我，JS语法，永远是面试中最重要的部分。</p><p>三、jQuery、Ajax等。jQuery没有过时，它仍然是前端基础的一部分。</p><p>四、ES6语法。这部分属于JS新增的语法，面试必问。其中，关于promise、async等内容要尤其关注。</p><p>五、HTML5和CSS3。要熟悉其中的新特性。</p><p>六、canvas。面试时，有的公司不一定会问canvas，靠运气。如果时间不够，这部分的内容可以先不学。但如果你会，绝对属于加分项。</p><p>七、移动Web开发、Bootstrap等。要注意移动开发中的适配和兼容性问题。</p><p>八、前端框架：Vue.js和React。这两个框架至少要会一个。入门时，建议先学Vue.js，上手相对容易。但无论如何，同时掌握 Vue 和 React 才是合格的前端同学。</p><p>九、Node.js。属于加分项，如果时间不够，可以先不学，但至少要知道 node 环境的配置。</p><p>十、自动化工具：构建工具 Webpack、构建工具 gulp、CSS 预处理器 Sass 等。注意，Sass 比 Less 用得多，gulp 比 grunt 用得多。</p><p>十一、前端综合：HTTP协议、跨域通信、安全问题（CSRF、XSS）、浏览器渲染机制、异步和单线程、页面性能优化、防抖动（Debouncing）和节流阀（Throtting）、lazyload、前端错误监控、虚拟DOM等。</p><p>十二、编辑器相关。Sublime Text 是每个学前端的人都要用到的编辑器。另外，前端常见的IDE有两个：WebStorm 和 Visual Studio Code。WebStorm什么都好，可就是太卡顿；VS Code就相对轻量很多。个人总结一下：新手一般用 WebStorm，入门之后，用 VS Code 的人更多。</p><p>十三、TypeScript（简称TS）。ES 是 JS 的标准，TS 是 JS 的超集。TS属于进阶内容，建议把上面的基础掌握之后，再学TS。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;2019年Web前端入门的自学路线&quot;&gt;&lt;a href=&quot;#2019年Web前端入门的自学路线&quot; class=&quot;headerlink&quot; title=&quot;2019年Web前端入门的自学路线&quot;&gt;&lt;/a&gt;2019年Web前端入门的自学路线&lt;/h3&gt;&lt;blockquote&gt;

      
    
    </summary>
    
    
      <category term="前端" scheme="http://blog.html-js.site/tags/%E5%89%8D%E7%AB%AF/"/>
    
  </entry>
  
</feed>
